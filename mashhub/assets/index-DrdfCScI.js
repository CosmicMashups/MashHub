const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SongModal-DGXWUw_A.js","assets/vendor-react-BqYHFrkR.js","assets/vendor-dexie-CKmTJlxL.js","assets/vendor-lucide-Bb8j8FOq.js","assets/Sheet-DSnqxl5f.js","assets/vendor-motion-DuQQDTmZ.js","assets/vendor-exceljs-Et7_ggJF.js","assets/vendor-dnd-dosGBBqk.js","assets/vendor-fuse-Dw8P0qyA.js","assets/AdvancedFiltersDialog-UelbPbM4.js","assets/ImportExportModal-BS4mMzUA.js","assets/EnhancedExportModal-B5qYdMDT.js","assets/UtilityDialog-CCujGi5B.js","assets/EnhancedProjectManager-DptBPNVN.js","assets/AddToProjectModal-BRrvnCNV.js","assets/SongDetailsModal-Lxgrxjnc.js"])))=>i.map(i=>d[i]);
import{r as u,j as e,R as G,c as Ut}from"./vendor-react-BqYHFrkR.js";import{D as Vt}from"./vendor-dexie-CKmTJlxL.js";import{M as O,C as Ht,a as qt,E as De,b as Qe,P as Re,c as Q,T as Oe,d as Yt,e as Gt,L as Wt,A as Qt,f as Jt,g as Xt,X as Y,h as me,F as ge,S as Ie,i as Zt,j as _e,k as er,l as tr,B as dt,G as rr,I as sr,m as ar,n as nr,Y as or,o as ir,V as cr,p as lr,q as mt,r as dr,s as mr,t as gr}from"./vendor-lucide-Bb8j8FOq.js";import{E as Je}from"./vendor-exceljs-Et7_ggJF.js";import{D as ur,c as hr,a as pr}from"./vendor-dnd-dosGBBqk.js";import{F as gt}from"./vendor-fuse-Dw8P0qyA.js";import{A as xr,m as Xe}from"./vendor-motion-DuQQDTmZ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const yr="modulepreload",fr=function(t){return"/MashHub/"+t},Ze={},B=function(s,r,a){let o=Promise.resolve();if(r&&r.length>0){let l=function(i){return Promise.all(i.map(m=>Promise.resolve(m).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),d=c?.nonce||c?.getAttribute("nonce");o=l(r.map(i=>{if(i=fr(i),i in Ze)return;Ze[i]=!0;const m=i.endsWith(".css"),f=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${f}`))return;const x=document.createElement("link");if(x.rel=m?"stylesheet":yr,m||(x.as="script"),x.crossOrigin="",x.href=i,d&&x.setAttribute("nonce",d),document.head.appendChild(x),m)return new Promise((g,h)=>{x.addEventListener("load",g),x.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})}))}function n(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return o.then(c=>{for(const d of c||[])d.status==="rejected"&&n(d.reason);return s().catch(n)})},br=400,ne=new Map,oe=new Map,Me=[];let ke=!1;function wr(t){return t.trim().toLowerCase()}async function jr(){if(!ke){for(ke=!0;Me.length>0;)Me.shift()?.(),await new Promise(s=>setTimeout(s,br));ke=!1}}function kr(t){return new Promise((s,r)=>{Me.push(()=>{t().then(s,r)}),jr()})}async function vr(t){const r=`https://api.jikan.moe/v4/anime?q=${encodeURIComponent(t)}&limit=1`,a=await fetch(r);if(a.status===429)return console.warn("Jikan API rate limit reached for query:",t),null;if(!a.ok)return console.error("Jikan API error:",a.status,a.statusText),null;const o=await a.json();return!o.data||o.data.length===0?null:o.data[0]?.images?.jpg?.large_image_url??null}async function Sr(t){if(!t||typeof t!="string")return null;const s=wr(t);if(!s)return null;if(ne.has(s))return ne.get(s)??null;const r=oe.get(s);if(r)return r;const a=kr(()=>vr(s)).then(o=>(ne.set(s,o),oe.delete(s),o),o=>(console.error("Error fetching anime cover from Jikan API:",o),ne.set(s,null),oe.delete(s),null));return oe.set(s,a),a}const Nr=.6,Cr=100,ut=2,Ir=25,et=.4,ve=.3,Mr=.1,Er=.05,Ar=.05,Tr=.45,Pr=.45,Fr=.05,Lr=.05,tt=10,Se=100,Ee=new Map;function ht(t){Ee.delete(t)}function Dr(t){for(const s of Ee.keys())s.startsWith(t)&&Ee.delete(s)}const pt="sections:";function Rr(t){ht(`${pt}${t}`)}function rt(){Dr(pt),ht("parts:unique")}const Or=["songs","songSections","projects","projectEntries","spotifyMappings"];class xt extends Vt{songs;songSections;projects;projectEntries;spotifyMappings;constructor(){super("MashupDatabase"),this.version(1).stores({songs:"id, title, artist, type, year, primaryBpm, primaryKey, origin, season, part, bpms, keys",projects:"id, name, createdAt",projectEntries:"id, projectId, songId, sectionName, orderIndex"}),this.version(2).stores({songs:"id, title, artist, type, year, primaryBpm, primaryKey, origin, season, part, bpms, keys, [artist+type], [year+season]",projects:"id, name, createdAt",projectEntries:"id, projectId, songId, sectionName, orderIndex, [projectId+orderIndex]"}).upgrade(()=>{}),this.version(3).stores({songs:"id, title, artist, type, year, origin, season, [artist+type], [year+season]",songSections:"sectionId, songId, bpm, key, [songId+bpm], [songId+key], [songId+sectionOrder]",projects:"id, name, createdAt",projectEntries:"id, projectId, songId, sectionId, sectionName, orderIndex, [projectId+orderIndex]"}).upgrade(async s=>{const r=await s.table("songs").toArray(),a=[],o=[];let n=1;for(const d of r){const l={id:d.id,title:d.title,artist:d.artist,type:d.type,origin:d.origin,year:d.year,season:d.season,notes:d.notes||"",bpms:[],keys:[]};a.push(l);const i=d.bpms||[],m=d.keys||[],f=d.part||"Main",x=f.includes(",")?f.split(",").map(h=>h.trim()):[f],g=Math.max(i.length,m.length,x.length,1);for(let h=0;h<g;h++){const y={sectionId:`section_${n++}`,songId:d.id,part:x[h]||x[0]||"Main",bpm:i[h]||i[0]||0,key:m[h]||m[0]||"C Major",sectionOrder:h+1};o.push(y)}}await s.table("songs").clear(),await s.table("songs").bulkAdd(a),await s.table("songSections").bulkAdd(o);const c=await s.table("projectEntries").toArray();for(const d of c)await s.table("projectEntries").update(d.id,{sectionId:null})}),this.version(4).stores({songs:"id, title, artist, type, year, origin, season, [artist+type], [year+season]",songSections:"sectionId, songId, bpm, key, [songId+bpm], [songId+key], [songId+sectionOrder]",projects:"id, name, createdAt",projectEntries:"id, projectId, songId, sectionId, sectionName, orderIndex, [projectId+orderIndex]",spotifyMappings:"songId, spotifyTrackId, confidenceScore"}).upgrade(async()=>{}),this.version(5).stores({songs:"id, title, artist, type, year, origin, season, [artist+type], [year+season], [title+artist]",songSections:"sectionId, songId, bpm, key, [songId+bpm], [songId+key], [songId+sectionOrder]",projects:"id, name, createdAt",projectEntries:"id, projectId, songId, sectionId, sectionName, orderIndex, [projectId+orderIndex]",spotifyMappings:"songId, spotifyTrackId, confidenceScore"}).upgrade(async()=>{})}}const j=new xt;j.open().then(()=>{const t=new Set(j.tables.map(s=>s.name));for(const s of Or)t.has(s)||console.warn(`Schema integrity: missing table "${s}". Some features may be unavailable.`)}).catch(t=>{console.error("Failed to open database:",t)});function _r(t){return t.length===0?void 0:(t.find(r=>r.sectionOrder===1)||t[0]).bpm}function Br(t){return t.length===0?void 0:(t.find(r=>r.sectionOrder===1)||t[0]).key}function $r(t){const s=t.sort((r,a)=>r.sectionOrder-a.sectionOrder).map(r=>r.bpm);return Array.from(new Set(s))}function Kr(t){const s=t.sort((r,a)=>r.sectionOrder-a.sectionOrder).map(r=>r.key);return Array.from(new Set(s))}async function H(t){if(t.length===0)return[];const s=t.map(o=>o.id),r=await j.songSections.where("songId").anyOf(s).toArray(),a=new Map;for(const o of r){const n=a.get(o.songId)??[];n.push(o),a.set(o.songId,n)}return t.map(o=>{const n=(a.get(o.id)??[]).sort((c,d)=>c.sectionOrder-d.sectionOrder);return{...o,bpms:$r(n),keys:Kr(n),primaryBpm:_r(n),primaryKey:Br(n)}})}const F={async getAll(){const t=await j.songs.orderBy("title").toArray();return H(t)},async getPaginated(t,s=25){const r=await j.songs.count(),a=(t-1)*s,o=await j.songs.orderBy("title").offset(a).limit(s).toArray();return{songs:await H(o),total:r}},async getById(t){const s=await j.songs.get(t);if(!s)return;const[r]=await H([s]);return r},async add(t){return await j.songs.add(t)},async bulkAdd(t){for(let s=0;s<t.length;s+=Se){const r=t.slice(s,s+Se);await j.songs.bulkAdd(r),s+Se<t.length&&await new Promise(a=>setTimeout(a,0))}rt()},async clearAll(){await j.transaction("rw",[j.songs,j.songSections],async()=>{await j.songs.clear(),await j.songSections.clear()}),rt()},async update(t){const{id:s,...r}=t;return await j.songs.update(s,r)},async delete(t){await j.transaction("rw",[j.songs,j.songSections],async()=>{await j.songSections.where("songId").equals(t).delete(),await j.songs.delete(t)}),Rr(t)},async search(t){const s=t.toLowerCase(),r=await j.songs.filter(a=>a.title.toLowerCase().includes(s)||a.artist.toLowerCase().includes(s)||a.type.toLowerCase().includes(s)||a.origin.toLowerCase().includes(s)).toArray();return H(r)},async searchPaginated(t,s,r=25){const a=t.toLowerCase(),o=await j.songs.filter(i=>i.title.toLowerCase().includes(a)||i.artist.toLowerCase().includes(a)||i.type.toLowerCase().includes(a)||i.origin.toLowerCase().includes(a)).toArray(),n=o.length,c=(s-1)*r,d=o.slice(c,c+r);return{songs:await H(d),total:n}},async filterByBpm(t,s){const r=await j.songSections.where("bpm").between(t,s,!0,!0).toArray(),a=Array.from(new Set(r.map(n=>n.songId))),o=await j.songs.where("id").anyOf(a).toArray();return H(o)}},z={async getBySongId(t){return await j.songSections.where("songId").equals(t).sortBy("sectionOrder")},async getById(t){return await j.songSections.get(t)},async add(t){return await j.songSections.add(t)},async bulkAdd(t){await j.songSections.bulkAdd(t)},async update(t){const{sectionId:s,...r}=t;return await j.songSections.update(s,r)},async delete(t){await j.songSections.delete(t)},async deleteBySongId(t){await j.songSections.where("songId").equals(t).delete()},async getUniqueParts(){const t=await j.songSections.toArray(),s=new Set(t.map(r=>r.part).filter(Boolean));return Array.from(s).sort()},async cleanOrphanedSections(){const[t,s]=await Promise.all([j.songs.toCollection().primaryKeys(),j.songSections.toArray()]),r=new Set(t),a=s.filter(o=>!r.has(o.songId)).map(o=>o.sectionId);return a.length>0&&await j.songSections.bulkDelete(a),a.length}},R={async getAll(){return await j.projects.orderBy("createdAt").reverse().toArray()},async getById(t){return await j.projects.get(t)},async add(t){return await j.projects.add(t)},async update(t){const{id:s,...r}=t;return await j.projects.update(s,r)},async delete(t){await j.transaction("rw",[j.projects,j.projectEntries],async()=>{await j.projectEntries.where("projectId").equals(t).delete(),await j.projects.delete(t)})},async getSongs(t){return await j.projectEntries.where("projectId").equals(t).toArray().then(s=>s.sort((r,a)=>r.orderIndex-a.orderIndex))},async addSongToProject(t,s,r="Main",a){const o=await j.projectEntries.where("projectId").equals(t).toArray(),n=o.length>0?Math.max(...o.map(d=>d.orderIndex)):-1,c={id:Date.now().toString(),projectId:t,songId:s,sectionId:a??null,sectionName:r,orderIndex:n+1};return await j.projectEntries.add(c)},async removeSongFromProject(t,s){await j.projectEntries.where("projectId").equals(t).and(r=>r.songId===s).delete()},async reorderSongs(t,s){await j.transaction("rw",j.projectEntries,async()=>{for(let r=0;r<s.length;r++)await j.projectEntries.where("projectId").equals(t).and(a=>a.songId===s[r]).modify({orderIndex:r})})},async getProjectWithSections(t){const s=await this.getById(t);if(!s)throw new Error("Project not found");const r=await this.getSongs(t),a=[...new Set(r.map(l=>l.songId))],o=await j.songs.where("id").anyOf(a).toArray(),n=await H(o),c=new Map(n.map(l=>[l.id,l])),d={};for(const l of r){d[l.sectionName]||(d[l.sectionName]=[]);const i=c.get(l.songId);i&&d[l.sectionName].push(i)}for(const l of Object.keys(d))d[l].sort((i,m)=>{const f=r.find(g=>g.songId===i.id&&g.sectionName===l),x=r.find(g=>g.songId===m.id&&g.sectionName===l);return(f?.orderIndex??0)-(x?.orderIndex??0)});return{...s,sections:d}},async reorderSongsInSection(t,s,r){await j.transaction("rw",j.projectEntries,async()=>{for(let a=0;a<r.length;a++)await j.projectEntries.where(["projectId","songId"]).equals([t,r[a]]).modify({orderIndex:a})})},async moveSongToSection(t,s,r){await j.projectEntries.where(["projectId","songId"]).equals([t,s]).modify({sectionName:r})}},ra=Object.freeze(Object.defineProperty({__proto__:null,MashupDatabase:xt,db:j,projectService:R,sectionService:z,songService:F},Symbol.toStringTag,{value:"Module"})),zr="https://api.spotify.com/v1",Ur="https://accounts.spotify.com/api/token";class Vr{clientId;clientSecret;accessToken=null;tokenExpiry=0;constructor(){this.clientId="",this.clientSecret=""}async authenticate(){if(this.accessToken&&Date.now()<this.tokenExpiry)return this.accessToken;if(!this.clientId||!this.clientSecret)throw new Error("Spotify API credentials not configured. Please set VITE_SPOTIFY_CLIENT_ID and VITE_SPOTIFY_CLIENT_SECRET environment variables.");try{const s=await fetch(Ur,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${this.clientId}:${this.clientSecret}`)}`},body:"grant_type=client_credentials"});if(!s.ok){const a=await s.text();throw new Error(`Spotify authentication failed: ${a}`)}const r=await s.json();return this.accessToken=r.access_token,this.tokenExpiry=Date.now()+(r.expires_in-300)*1e3,this.accessToken}catch(s){throw console.error("Spotify authentication error:",s),s}}async apiRequest(s,r=3){const a=await this.authenticate();for(let o=0;o<r;o++)try{const n=await fetch(`${zr}${s}`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(n.status===429){const c=parseInt(n.headers.get("Retry-After")||"1",10);await new Promise(d=>setTimeout(d,c*1e3));continue}if(!n.ok){const c=await n.text();throw new Error(`Spotify API error (${n.status}): ${c}`)}return await n.json()}catch(n){if(o===r-1)throw n;await new Promise(c=>setTimeout(c,Math.pow(2,o)*1e3))}throw new Error("Spotify API request failed after retries")}async searchTrack(s,r,a,o="US"){if(!s.trim())return[];const n=[],c=this.normalizeQuery(s);if(n.push(`track:${c}`),r&&r.trim()){const i=this.normalizeQuery(r);n.push(`artist:${i}`)}a&&n.push(`year:${a}`);const d=n.join(" "),l=encodeURIComponent(d);try{return(await this.apiRequest(`/search?q=${l}&type=track&limit=20&market=${o}`)).tracks.items}catch(i){return console.error("Spotify search error:",i),[]}}async getTrack(s,r="US"){try{return await this.apiRequest(`/tracks/${s}?market=${r}`)}catch(a){return console.error("Spotify getTrack error:",a),null}}async getAlbum(s,r="US"){try{return await this.apiRequest(`/albums/${s}?market=${r}`)}catch(a){return console.error("Spotify getAlbum error:",a),null}}normalizeQuery(s){return s.trim().replace(/[()[\]]/g,"").replace(/\s+/g," ").trim()}isConfigured(){return!!(this.clientId&&this.clientSecret)}}const ie=new Vr;function Hr(t,s){const r=t.length,a=s.length,o=[];for(let n=0;n<=r;n++)o[n]=[n];for(let n=0;n<=a;n++)o[0][n]=n;for(let n=1;n<=r;n++)for(let c=1;c<=a;c++)t[n-1]===s[c-1]?o[n][c]=o[n-1][c-1]:o[n][c]=Math.min(o[n-1][c]+1,o[n][c-1]+1,o[n-1][c-1]+1);return o[r][a]}function st(t,s){const r=Math.max(t.length,s.length);return r===0?1:1-Hr(t,s)/r}function ce(t){return t.toLowerCase().trim().replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}function qr(t,s,r){let a=0;const o=ce(t.title),n=ce(s.name),c=st(o,n);if(a+=c*40,t.artist&&t.artist.trim()&&s.artists.length>0){const l=ce(t.artist),i=s.artists.map(f=>ce(f.name)),m=Math.max(...i.map(f=>st(l,f)));a+=m*30}else a+=10;if(t.year&&s.album){const l=Math.abs(t.year-t.year);l<=1?a+=20:l<=3?a+=15:l<=5&&(a+=10)}const d=r.findIndex(l=>l.id===s.id);return d===0?a+=10:d<3?a+=7:d<5&&(a+=5),Math.min(100,Math.round(a))}class Yr{async getMapping(s){try{return await j.spotifyMappings.get(s)||null}catch(r){return console.error("Error getting Spotify mapping:",r),null}}async searchAndMap(s,r="US"){if(!ie.isConfigured())return console.warn("Spotify API not configured"),null;try{const a=await ie.searchTrack(s.title,s.artist||void 0,s.year,r);if(a.length===0)return null;const o=a.map(g=>({track:g,confidence:qr(s,g,a)}));o.sort((g,h)=>h.confidence-g.confidence);const n=o[0];if(n.confidence<70)return null;const c=n.track,d=await ie.getTrack(c.id,r);if(!d)return null;const l=d.album.images||[],i=l.find(g=>g.height>=640)||l[0],m=l.find(g=>g.height>=300&&g.height<640)||l[1]||l[0],f=l.find(g=>g.height<300)||l[l.length-1]||l[0],x={songId:s.id,spotifyTrackId:d.id,spotifyAlbumId:d.album.id,imageUrlLarge:i?.url,imageUrlMedium:m?.url,imageUrlSmall:f?.url,previewUrl:d.preview_url||void 0,spotifyExternalUrl:d.external_urls.spotify,confidenceScore:n.confidence,mappedAt:new Date,manualOverride:!1,marketCode:r};return await this.saveMapping(x),x}catch(a){return console.error("Error searching and mapping song:",a),null}}async saveMapping(s){try{await j.spotifyMappings.put(s)}catch(r){throw console.error("Error saving Spotify mapping:",r),r}}async updateMapping(s,r,a=!0){try{const o=await ie.getTrack(r);if(!o)return null;const n=o.album.images||[],c=n.find(m=>m.height>=640)||n[0],d=n.find(m=>m.height>=300&&m.height<640)||n[1]||n[0],l=n.find(m=>m.height<300)||n[n.length-1]||n[0],i={songId:s,spotifyTrackId:o.id,spotifyAlbumId:o.album.id,imageUrlLarge:c?.url,imageUrlMedium:d?.url,imageUrlSmall:l?.url,previewUrl:o.preview_url||void 0,spotifyExternalUrl:o.external_urls.spotify,confidenceScore:100,mappedAt:new Date,lastVerified:new Date,manualOverride:a,marketCode:"US"};return await this.saveMapping(i),i}catch(o){return console.error("Error updating Spotify mapping:",o),null}}async deleteMapping(s){try{await j.spotifyMappings.delete(s)}catch(r){throw console.error("Error deleting Spotify mapping:",r),r}}async getAllMappings(){try{return await j.spotifyMappings.toArray()}catch(s){return console.error("Error getting all mappings:",s),[]}}async clearAllMappings(){try{await j.spotifyMappings.clear()}catch(s){throw console.error("Error clearing mappings:",s),s}}}const at=new Yr;async function Gr(t){if(!t)return null;if(t.type?.toLowerCase()==="anime")return t.origin?await Sr(t.origin):null;try{const r=await at.getMapping(t.id);if(r)return r.imageUrlLarge||r.imageUrlMedium||r.imageUrlSmall||null;const a=await at.searchAndMap(t);return a&&(a.imageUrlLarge||a.imageUrlMedium||a.imageUrlSmall)||null}catch(r){return console.error("Error resolving Spotify cover image:",r),null}}const Z=new Map;function yt(t){const[s,r]=u.useState(new Map),[a,o]=u.useState(!1),n=u.useRef(t);n.current=t;const c=t.map(l=>l.id).join(",");return u.useEffect(()=>{(async()=>{const i=n.current;if(i.length===0){r(new Map);return}if(i.every(x=>Z.has(x.id)))return;o(!0);const f=new Map;try{const x=i.map(async g=>{try{const h=Z.get(g.id);if(h!==void 0){f.set(g.id,h);return}const y=await Gr(g);f.set(g.id,y),Z.set(g.id,y)}catch(h){console.error(`Error loading cover image for song ${g.id}:`,h),f.set(g.id,null),Z.set(g.id,null)}});await Promise.all(x),r(f)}catch(x){console.error("Error loading cover images:",x)}finally{o(!1)}})()},[c]),{coverImages:s,loading:a,getCoverImage:l=>Z.get(l)??s.get(l)??null}}const Wr={small:"w-12 h-12",medium:"w-24 h-24",large:"w-64 h-64"};function Be({imageUrl:t,alt:s="Album artwork",size:r="medium",className:a="",lazy:o=!0,aspectRatio:n="square"}){const[c,d]=u.useState(!1),[l,i]=u.useState(!1),m=()=>a.includes("w-full")||a.includes("h-full")?`${n==="portrait"?"aspect-[2/3]":"aspect-square"} ${a}`:n==="portrait"?`${r==="small"?"w-12":r==="medium"?"w-24":"w-64"} aspect-[2/3] ${a}`:`${Wr[r]} aspect-square ${a}`;return!t||c?e.jsx("div",{className:`${m()} bg-gray-200 dark:bg-gray-700 rounded flex items-center justify-center`,children:e.jsx(O,{className:"text-gray-400 dark:text-gray-500",size:r==="small"?20:r==="medium"?32:64})}):e.jsxs("div",{className:`${m()} relative rounded overflow-hidden bg-gray-200 dark:bg-gray-700`,children:[!l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(O,{className:"text-gray-400 dark:text-gray-500 animate-pulse",size:r==="small"?20:r==="medium"?32:64})}),e.jsx("img",{src:t,alt:s,className:`w-full h-full object-cover transition-opacity duration-300 ${l?"opacity-100":"opacity-0"}`,loading:o?"lazy":"eager",onLoad:()=>i(!0),onError:()=>{d(!0),i(!1)}})]})}function ft({currentPage:t,totalItems:s,itemsPerPage:r,onPageChange:a,onItemsPerPageChange:o,className:n=""}){const c=Math.ceil(s/r);if(c<=1||s===0)return null;const d=(t-1)*r+1,l=Math.min(t*r,s),i=()=>{t>1&&(a(t-1),window.scrollTo({top:0,behavior:"smooth"}))},m=()=>{t<c&&(a(t+1),window.scrollTo({top:0,behavior:"smooth"}))},f=h=>{a(h),window.scrollTo({top:0,behavior:"smooth"})},x=()=>{const h=[];if(c<=7)for(let p=1;p<=c;p++)h.push(p);else if(t<=3){for(let p=1;p<=4;p++)h.push(p);h.push("ellipsis"),h.push(c)}else if(t>=c-2){h.push(1),h.push("ellipsis");for(let p=c-3;p<=c;p++)h.push(p)}else{h.push(1),h.push("ellipsis");for(let p=t-1;p<=t+1;p++)h.push(p);h.push("ellipsis"),h.push(c)}return h},g=h=>{const y=parseInt(h.target.value);o&&(o(y),a(1))};return e.jsxs("div",{className:`flex items-center justify-between px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 ${n}`,children:[e.jsx("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:e.jsxs("span",{children:["Showing ",e.jsx("span",{className:"font-medium",children:d})," to"," ",e.jsx("span",{className:"font-medium",children:l})," of"," ",e.jsx("span",{className:"font-medium",children:s})," results"]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[o&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{htmlFor:"items-per-page",className:"text-sm text-gray-700 dark:text-gray-300",children:"Per page:"}),e.jsxs("select",{id:"items-per-page",value:r,onChange:g,className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:i,disabled:t===1,className:`p-2 rounded-lg transition-colors ${t===1?"text-gray-400 cursor-not-allowed":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,"aria-label":"Previous page",children:e.jsx(Ht,{size:20})}),e.jsx("div",{className:"flex items-center space-x-1",children:x().map((h,y)=>{if(h==="ellipsis")return e.jsx("span",{className:"px-2 text-gray-400",children:"..."},`ellipsis-${y}`);const p=h,w=p===t;return e.jsx("button",{onClick:()=>f(p),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${w?"bg-music-electric text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,"aria-label":`Go to page ${p}`,"aria-current":w?"page":void 0,children:p},p)})}),e.jsx("button",{onClick:m,disabled:t===c,className:`p-2 rounded-lg transition-colors ${t===c?"text-gray-400 cursor-not-allowed":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,"aria-label":"Next page",children:e.jsx(qt,{size:20})})]})]})]})}const bt=u.memo(function({song:s,compact:r=!1,coverImageUrl:a,onEditSong:o,onDeleteSong:n,onAddToProject:c,onSongClick:d,searchScore:l}){const[i,m]=u.useState(!1),f=u.useRef(null),x=s.primaryBpm||s.bpms?.[0],g=s.primaryKey||s.keys?.[0],h=s.vocalStatus||(s.type?.includes("Vocal")?"Vocal":"Instrumental"),p=(()=>{if(l===void 0)return null;const w=Math.round((1-l)*100);let v="text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700";return w>=80?v="text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30":w>=60&&(v="text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30"),{percentage:w,colorClass:v}})();return u.useEffect(()=>{const w=v=>{f.current&&!f.current.contains(v.target)&&m(!1)};if(i)return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[i]),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"shrink-0",children:e.jsx(Be,{imageUrl:a,alt:`${s.title} by ${s.artist}`,size:"small",aspectRatio:"square"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg truncate text-gray-900 dark:text-white",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate text-gray-600 dark:text-gray-400",children:s.artist})]})]}),e.jsxs("div",{className:"relative",ref:f,children:[e.jsx("button",{onClick:()=>m(!i),className:"h-9 w-9 min-w-[44px] min-h-[44px] flex items-center justify-center shrink-0 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"More options",children:e.jsx(De,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),i&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-50",children:[e.jsxs("button",{onClick:()=>{d?.(s),m(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),"View Details"]}),e.jsxs("button",{onClick:()=>{o?.(s),m(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Edit Song"]}),e.jsxs("button",{onClick:()=>{c?.(s),m(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Add to Project"]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),e.jsxs("button",{onClick:()=>{window.confirm("Are you sure you want to delete this song?")&&n?.(s.id),m(!1)},className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[x&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:[x," BPM"]}),e.jsx("span",{className:"text-gray-400",children:"•"})]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:g}),e.jsx("span",{className:"text-gray-400",children:"•"})]}),s.year&&e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:s.year})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[p&&e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${p.colorClass}`,children:[p.percentage,"% match"]}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200",children:r?h[0]:h}),s.type&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-600",children:s.type})]}),!r&&s.sections&&s.sections.length>1&&e.jsxs("button",{className:"w-full mt-3 flex items-center justify-between text-xs text-muted-foreground hover:text-gray-900 dark:hover:text-gray-100 py-2 px-2 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",onClick:()=>d?.(s),children:[e.jsxs("span",{children:[s.sections.length," sections"]}),e.jsx("span",{children:"View →"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 px-4 py-2 flex gap-2",children:[e.jsxs("button",{className:"flex-1 h-9 min-h-[44px] flex items-center justify-center gap-2 text-xs font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",onClick:()=>d?.(s),children:[e.jsx(Qe,{className:"h-4 w-4 md:mr-1"}),e.jsx("span",{className:"hidden md:inline",children:"View"})]}),e.jsxs("button",{className:"flex-1 h-9 min-h-[44px] flex items-center justify-center gap-2 text-xs font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",onClick:()=>c?.(s),children:[e.jsx(Q,{className:"h-4 w-4 md:mr-1"}),e.jsx("span",{className:"hidden md:inline",children:"Add"})]})]})]})});function wt(t){const[s,r]=u.useState(!1);return u.useEffect(()=>{if(typeof window>"u")return;const a=window.matchMedia(t);a.matches!==s&&r(a.matches);const o=n=>{r(n.matches)};return a.addEventListener?(a.addEventListener("change",o),()=>a.removeEventListener("change",o)):(a.addListener(o),()=>a.removeListener(o))},[s,t]),s}const sa=()=>wt("(max-width: 640px)"),jt=()=>wt("(min-width: 1024px)"),Qr=25,Jr=u.memo(function({songs:s,onEditSong:r,onDeleteSong:a,onAddToProject:o,onSongClick:n}){const[c,d]=u.useState(null),[l,i]=u.useState("asc"),[m,f]=u.useState(1),[x,g]=u.useState(Qr),h=jt(),p=c?[...s].sort((k,A)=>{let b,C;switch(c){case"title":b=k.title.toLowerCase(),C=A.title.toLowerCase();break;case"artist":b=k.artist.toLowerCase(),C=A.artist.toLowerCase();break;case"bpm":b=k.primaryBpm||k.bpms[0]||0,C=A.primaryBpm||A.bpms[0]||0;break;case"key":b=k.primaryKey||k.keys[0]||"",C=A.primaryKey||A.keys[0]||"";break;case"year":b=k.year,C=A.year;break;case"origin":b=k.origin.toLowerCase(),C=A.origin.toLowerCase();break;case"season":b=k.season.toLowerCase(),C=A.season.toLowerCase();break;case"type":b=k.type.toLowerCase(),C=A.type.toLowerCase();break;default:return 0}return b<C?l==="asc"?-1:1:b>C?l==="asc"?1:-1:0}):s,w=(m-1)*x,v=w+x,N=p.slice(w,v);u.useEffect(()=>{f(1)},[x]);const{getCoverImage:M}=yt(N),E=k=>({"C Major":"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 dark:border-red-500","C# Major":"bg-red-100 dark:bg-red-900/30 border-l-4 border-red-500 dark:border-red-400","D Major":"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-400 dark:border-orange-500","D# Major":"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 dark:border-yellow-500","E Major":"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-400 dark:border-green-500","F Major":"bg-green-100 dark:bg-green-900/30 border-l-4 border-green-600 dark:border-green-400","F# Major":"bg-sky-50 dark:bg-sky-900/20 border-l-4 border-sky-300 dark:border-sky-400","G Major":"bg-sky-100 dark:bg-sky-900/30 border-l-4 border-sky-400 dark:border-sky-300","G# Major":"bg-violet-50 dark:bg-violet-900/20 border-l-4 border-violet-500 dark:border-violet-400","A Major":"bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-400 dark:border-purple-500","A# Major":"bg-orange-100 dark:bg-orange-900/30 border-l-4 border-orange-500 dark:border-orange-400","B Major":"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 dark:border-blue-400","C Minor":"bg-red-100 dark:bg-red-900/30 border-l-4 border-red-600 dark:border-red-500","C# Minor":"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 dark:border-red-400","D Minor":"bg-orange-100 dark:bg-orange-900/30 border-l-4 border-orange-500 dark:border-orange-400","D# Minor":"bg-yellow-100 dark:bg-yellow-900/30 border-l-4 border-yellow-500 dark:border-yellow-400","E Minor":"bg-green-100 dark:bg-green-900/30 border-l-4 border-green-500 dark:border-green-400","F Minor":"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-700 dark:border-green-500","F# Minor":"bg-sky-100 dark:bg-sky-900/30 border-l-4 border-sky-400 dark:border-sky-300","G Minor":"bg-sky-50 dark:bg-sky-900/20 border-l-4 border-sky-500 dark:border-sky-400","G# Minor":"bg-violet-100 dark:bg-violet-900/30 border-l-4 border-violet-600 dark:border-violet-500","A Minor":"bg-purple-100 dark:bg-purple-900/30 border-l-4 border-purple-500 dark:border-purple-400","A# Minor":"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-600 dark:border-orange-500","B Minor":"bg-blue-100 dark:bg-blue-900/30 border-l-4 border-blue-600 dark:border-blue-500"})[k]||"bg-gray-50 dark:bg-gray-800/50 border-l-4 border-gray-300 dark:border-gray-600",_=()=>"text-gray-900 dark:text-gray-100",U=k=>{window.confirm("Are you sure you want to delete this song?")&&a?.(k)},L=k=>{c===k?i(l==="asc"?"desc":"asc"):(d(k),i("asc"))};u.useEffect(()=>{f(1)},[s.length]);const T=k=>c!==k?e.jsx(Qt,{size:14,className:"text-gray-400"}):l==="asc"?e.jsx(Jt,{size:14,className:"text-music-electric"}):e.jsx(Xt,{size:14,className:"text-music-electric"});return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-music-electric to-music-cosmic rounded-lg flex items-center justify-center",children:e.jsx(Yt,{size:18,className:"text-white"})}),e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Music Library"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Sort",children:e.jsx(Gt,{size:16})}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Filter",children:e.jsx(Wt,{size:16})}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"View Options",children:e.jsx(De,{size:16})})]})]})}),s.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(O,{size:40,className:"text-gray-300 dark:text-gray-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No songs found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Start building your music library by adding some songs"}),e.jsx("div",{className:"animate-float",children:e.jsx("div",{className:"w-8 h-8 bg-primary-100 dark:bg-primary-900/30 rounded-full flex items-center justify-center mx-auto",children:e.jsx(O,{size:16,className:"text-primary-600 dark:text-primary-400"})})})]}):h?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-music-electric/10 via-music-cosmic/10 to-music-neon/10 dark:from-music-electric/20 dark:via-music-cosmic/20 dark:to-music-neon/20 text-gray-700 dark:text-gray-300 font-bold",children:[e.jsx("th",{className:"px-3 py-3 text-center align-middle w-16 hidden sm:table-cell",children:e.jsx("span",{children:"Artwork"})}),e.jsx("th",{className:"px-3 py-3 text-center align-middle w-28 sm:w-32 md:w-40 lg:w-48",children:e.jsxs("button",{onClick:()=>L("artist"),className:"w-full flex items-center justify-center space-x-2 hover:text-music-electric transition-colors",children:[e.jsx("span",{children:"Artist"}),T("artist")]})}),e.jsx("th",{className:"px-3 py-3 text-center align-middle w-40 sm:w-52 md:w-60 lg:w-64",children:e.jsxs("button",{onClick:()=>L("title"),className:"w-full flex items-center justify-center space-x-2 hover:text-music-electric transition-colors",children:[e.jsx("span",{children:"Song"}),T("title")]})}),e.jsx("th",{className:"px-4 py-3 text-center align-middle hidden md:table-cell w-36",children:e.jsxs("button",{onClick:()=>L("key"),className:"w-full flex items-center justify-center space-x-2 hover:text-music-electric transition-colors",children:[e.jsx("span",{children:"Key"}),T("key")]})}),e.jsx("th",{className:"px-4 py-3 text-center align-middle hidden sm:table-cell w-24",children:e.jsxs("button",{onClick:()=>L("bpm"),className:"w-full flex items-center justify-center space-x-2 hover:text-music-electric transition-colors",children:[e.jsx("span",{children:"BPM"}),T("bpm")]})}),e.jsx("th",{className:"px-4 py-3 text-center align-middle hidden lg:table-cell w-24",children:e.jsxs("button",{onClick:()=>L("year"),className:"w-full flex items-center justify-center space-x-2 hover:text-music-electric transition-colors",children:[e.jsx("span",{children:"Year"}),T("year")]})}),e.jsx("th",{className:"px-4 py-3 text-center align-middle hidden xl:table-cell w-28",children:e.jsx("div",{className:"flex items-center justify-center space-x-2",children:e.jsx("span",{children:"Actions"})})})]})}),e.jsx("tbody",{children:N.map((k,A)=>{const b=k.primaryKey||k.keys[0]||"",C=E(b),P=_(),J=M(k.id);return e.jsxs("tr",{className:`table-row group ${C} ${P} hover:opacity-90 transition-opacity cursor-pointer`,style:{animationDelay:`${A*.05}s`},onClick:()=>n?.(k),children:[e.jsx("td",{className:"px-3 py-3 align-middle w-16 hidden sm:table-cell",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(Be,{imageUrl:J??void 0,alt:`${k.title} by ${k.artist}`,size:"small",aspectRatio:"square"})})}),e.jsx("td",{className:"px-3 py-3 text-center align-middle w-28 sm:w-32 md:w-40 lg:w-48",children:e.jsx("div",{className:`text-base font-semibold break-words whitespace-normal ${P}`,title:k.artist,children:k.artist})}),e.jsxs("td",{className:"px-3 py-3 text-center align-middle w-40 sm:w-52 md:w-60 lg:w-64",children:[e.jsx("div",{className:`text-base font-bold break-words whitespace-normal ${P}`,title:k.title,children:k.title}),k.part&&e.jsx("div",{className:`text-sm break-words whitespace-normal ${P} opacity-70`,title:k.part,children:k.part})]}),e.jsx("td",{className:"px-4 py-3 text-center hidden md:table-cell align-middle w-36",children:e.jsx("div",{className:"flex flex-col items-center space-y-1",children:k.keys.length>=2?e.jsxs("div",{className:"cursor-help",title:`All keys: ${k.keys.join(", ")}`,children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${C} ${P}`,children:k.primaryKey||k.keys[0]||"N/A"}),e.jsxs("span",{className:`text-xs ${P} opacity-60 block mt-1`,title:`All keys: ${k.keys.join(", ")}`,children:["+",k.keys.length-1]})]}):e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${C} ${P}`,children:k.primaryKey||k.keys[0]||"N/A"})})}),e.jsx("td",{className:"px-4 py-3 text-center hidden sm:table-cell align-middle w-24",children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-bold font-mono bg-music-wave/10 text-music-wave",children:k.primaryBpm||k.bpms[0]||"N/A"}),k.bpms.length>1&&e.jsxs("span",{className:`text-xs ${P} opacity-60`,title:`${k.bpms.length} total BPMs`,children:["+",k.bpms.length-1]})]})}),e.jsx("td",{className:"px-4 py-3 text-center hidden lg:table-cell align-middle w-24",children:e.jsx("div",{className:`text-sm font-bold ${P}`,children:k.year})}),e.jsx("td",{className:"px-4 py-3 text-center hidden xl:table-cell align-middle w-28",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx("button",{onClick:V=>{V.stopPropagation(),o?.(k)},className:"group p-2 text-gray-400 hover:text-music-electric hover:bg-music-electric/10 rounded-lg transition-all duration-200 hover:scale-110",title:"Add to project",children:e.jsx(Q,{size:14,className:"group-hover:scale-110 transition-transform"})}),e.jsx("button",{onClick:V=>{V.stopPropagation(),r?.(k)},className:"group p-2 text-gray-400 hover:text-music-electric hover:bg-music-electric/10 rounded-lg transition-all duration-200 hover:scale-110",title:"Edit song",children:e.jsx(Re,{size:14,className:"group-hover:rotate-12 transition-transform"})}),e.jsx("button",{onClick:V=>{V.stopPropagation(),U(k.id)},className:"group p-2 text-gray-400 hover:text-music-pulse hover:bg-music-pulse/10 rounded-lg transition-all duration-200 hover:scale-110",title:"Delete song",children:e.jsx(Oe,{size:14,className:"group-hover:rotate-12 transition-transform"})})]})})]},k.id)})})]})}):e.jsx("div",{className:"p-4 space-y-3 md:space-y-2",children:N.map(k=>{const A=M(k.id);return e.jsx(bt,{song:k,compact:!h,coverImageUrl:A??void 0,onEditSong:r,onDeleteSong:a,onAddToProject:o,onSongClick:n},k.id)})}),p.length>x&&e.jsx(ft,{currentPage:m,totalItems:p.length,itemsPerPage:x,onPageChange:f,onItemsPerPageChange:g})]})}),Xr="/MashHub/assets/songs-BXkbeCsC.csv",Zr="/MashHub/assets/song_sections-D4xIr43e.csv";function kt(t){const s=[];let r="",a=!1;for(let o=0;o<t.length;o++){const n=t[o];n==='"'?a=!a:n===","&&!a?(s.push(r.trim()),r=""):r+=n}return s.push(r.trim()),s}function es(){return Math.random().toString(36).substr(2,9)}function ts(t){return t>=2020?"Modern":t>=2010?"2010s":t>=2e3?"2000s":t>=1990?"1990s":"Classic"}function rs(t){let s=0;for(let r=0;r<t.length;r++)s=s*31+t.charCodeAt(r)>>>0;return s.toString(16)}function ss(t){const s=t.split(`
`).filter(a=>a.trim()),r=[];for(let a=1;a<s.length;a++){const o=s[a].trim();if(!o)continue;const n=kt(o);if(n.length<7)continue;const[c,d,l,i,m,f,x,g]=n;if(!d)continue;const h=parseInt(x)||2020,y=f&&f.trim()||ts(h),p=l&&l.trim()?l.trim():"Unknown Artist",w={id:c&&c.trim()||es(),title:d.trim(),artist:p,type:i&&i.trim()||"Anime",origin:m?.trim()??"",year:h,season:y,notes:g&&g.trim()||"",bpms:[],keys:[]};r.push(w)}return r}function as(t){const s=t.split(`
`).filter(a=>a.trim()),r=[];for(let a=1;a<s.length;a++){const o=s[a].trim();if(!o)continue;const n=kt(o);if(n.length<6)continue;const[c,d,l,i,m,f]=n;if(!d||!c)continue;const x=parseFloat(i)||0,g=parseInt(f)||1,h={sectionId:c.trim(),songId:d.trim(),part:l&&l.trim()||"Main",bpm:Number.isFinite(x)&&x>0?x:0,key:m&&m.trim()||"C Major",sectionOrder:g};r.push(h)}return r}async function nt(){try{const[t,s]=await Promise.all([fetch(Xr,{cache:"no-cache"}),fetch(Zr,{cache:"no-cache"})]);if(!t.ok||!s.ok)throw new Error("Failed to load CSV files");const r=await t.text(),a=await s.text(),o=ss(r),n=as(a),c=new Set(o.map(f=>f.id)),d=n.filter(f=>!c.has(f.songId));d.length>0&&console.warn(`Found ${d.length} orphan sections:`,d);const l=n.filter(f=>c.has(f.songId)),i=r+a,m=rs(i);return{songs:o,sections:l,hash:m}}catch(t){return console.error("Error loading songs and sections with hash:",t),{songs:[],sections:[],hash:""}}}function ns(t){return t&&/^[=+\-@]/.test(t)?`	${t}`:t}function $(t){return`"${ns(t).replace(/"/g,'""')}"`}class Ae{static async exportSongsToCSV(s,r){const a=[];for(const m of s){const f=await z.getBySongId(m.id);a.push(...f)}const n=[["ID","TITLE","ARTIST","TYPE","ORIGIN","SEASON","YEAR","NOTES"].join(","),...s.map(m=>[m.id,$(m.title),$(m.artist),$(m.type),$(m.origin),$(m.season),m.year,$(m.notes||"")].join(","))].join(`
`),d=[["SECTION_ID","SONG_ID","PART","BPM","KEY","SECTION_ORDER"].join(","),...a.map(m=>[m.sectionId,m.songId,$(m.part),m.bpm,$(m.key),m.sectionOrder].join(","))].join(`
`),l=new Blob([n],{type:"text/csv;charset=utf-8;"}),i=new Blob([d],{type:"text/csv;charset=utf-8;"});this.downloadFile(l,r?`songs-${r}`:`songs-${this.getDateString()}.csv`),setTimeout(()=>{this.downloadFile(i,r?`song_sections-${r}`:`song_sections-${this.getDateString()}.csv`)},100)}static async exportSongsToXLSX(s,r){const a=new Je.Workbook,o=a.addWorksheet("Songs");o.columns=[{header:"ID",key:"id",width:10},{header:"TITLE",key:"title",width:35},{header:"ARTIST",key:"artist",width:30},{header:"TYPE",key:"type",width:15},{header:"ORIGIN",key:"origin",width:15},{header:"YEAR",key:"year",width:10},{header:"SEASON",key:"season",width:10},{header:"NOTES",key:"notes",width:30}],s.forEach((i,m)=>{const f=o.addRow({id:i.id,title:i.title,artist:i.artist,type:i.type,origin:i.origin,year:i.year,season:i.season,notes:i.notes||""});m%2===0&&(f.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}})});const n=a.addWorksheet("Sections");n.columns=[{header:"SECTION_ID",key:"sectionId",width:15},{header:"SONG_ID",key:"songId",width:10},{header:"PART",key:"part",width:15},{header:"BPM",key:"bpm",width:10},{header:"KEY",key:"key",width:20},{header:"SECTION_ORDER",key:"sectionOrder",width:15}];const c=[];for(const i of s){const m=await z.getBySongId(i.id);c.push(...m)}c.forEach((i,m)=>{if(n.addRow({sectionId:i.sectionId,songId:i.songId,part:i.part,bpm:i.bpm,key:i.key,sectionOrder:i.sectionOrder}),m%2===0){const f=n.getRow(m+2);f.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8F9FA"}}}}),[o,n].forEach(i=>{const m=i.getRow(1);m.font={bold:!0,color:{argb:"FFFFFFFF"}},m.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF3B82F6"}},m.alignment={horizontal:"center",vertical:"middle"},i.eachRow(f=>{f.eachCell(x=>{x.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),i.autoFilter={from:"A1",to:{row:1,column:i.columnCount}},i.views=[{state:"frozen",ySplit:1}]});const d=await a.xlsx.writeBuffer(),l=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});this.downloadFile(l,r||`mashup-songs-${this.getDateString()}.xlsx`)}static async exportProjectToXLSX(s,r){const a=new Je.Workbook,o=a.addWorksheet("Project Info");o.addRow(["Project Name",s.name]),o.addRow(["Created",s.createdAt.toLocaleDateString()]),o.addRow(["Total Songs",Object.values(s.sections).flat().length]),o.addRow(["Sections",Object.keys(s.sections).join(", ")]);const n=a.addWorksheet("Songs");n.columns=[{header:"SECTION",key:"section",width:15},{header:"ORDER",key:"order",width:10},{header:"TITLE",key:"title",width:35},{header:"ARTIST",key:"artist",width:30},{header:"BPM",key:"bpm",width:15},{header:"KEY",key:"key",width:20},{header:"TYPE",key:"type",width:15}];for(const[l,i]of Object.entries(s.sections))for(let m=0;m<i.length;m++){const f=i[m],x=await z.getBySongId(f.id),g=x.find(h=>h.sectionOrder===1)||x[0];n.addRow({section:l,order:m+1,title:f.title,artist:f.artist,bpm:g?.bpm||"",key:g?.key||"",type:f.type})}[o,n].forEach(l=>{const i=l.getRow(1);i.font={bold:!0,color:{argb:"FFFFFFFF"}},i.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF3B82F6"}}});const c=await a.xlsx.writeBuffer(),d=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});this.downloadFile(d,r||`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}-${this.getDateString()}.xlsx`)}static async exportToJSON(s,r){const a=await Promise.all(s.map(async c=>{const d=await z.getBySongId(c.id);return{...c,sections:d.sort((l,i)=>l.sectionOrder-i.sectionOrder)}})),o=JSON.stringify(a,null,2),n=new Blob([o],{type:"application/json"});this.downloadFile(n,r||`mashup-data-${this.getDateString()}.json`)}static exportProjectToJSON(s,r){const a=JSON.stringify(s,(c,d)=>d instanceof Date?d.toISOString():d,2),o=new Blob([a],{type:"application/json;charset=utf-8;"}),n=s.name?.replace(/[^a-zA-Z0-9]/g,"_")||"project";this.downloadFile(o,r||`${n}-${this.getDateString()}.json`)}static downloadFile(s,r){const a=window.URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download=r,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a)}static getDateString(){return new Date().toISOString().split("T")[0]}}const aa=Object.freeze(Object.defineProperty({__proto__:null,ExportService:Ae},Symbol.toStringTag,{value:"Module"}));function os(){const[t,s]=u.useState([]),[r,a]=u.useState(!0),[o,n]=u.useState(null),c=u.useCallback(async()=>{try{console.log("Starting to load songs..."),a(!0),n(null);let p=await F.getAll();if(console.log("Retrieved songs from database:",p.length),p.length===0){console.log("Database is empty, loading songs and sections from CSV...");const{songs:w,sections:v,hash:N}=await nt();console.log("Loaded songs:",w.length,"sections:",v.length),localStorage.setItem("songsCsvHash",N),w.length>0&&(console.log("Adding songs and sections to database..."),await F.bulkAdd(w),await z.bulkAdd(v),p=await F.getAll(),console.log(`Successfully loaded ${w.length} songs with ${v.length} sections`))}console.log("Setting songs state with:",p.length,"songs"),s(p)}catch(p){console.error("Error in loadSongs:",p),n(p instanceof Error?p.message:"Failed to load songs")}finally{console.log("Setting loading to false"),a(!1)}},[]),d=u.useCallback(async()=>{try{a(!0),await F.clearAll();const{songs:p,sections:w}=await nt();if(p.length>0){await F.bulkAdd(p),await z.bulkAdd(w);const v=await F.getAll();s(v)}else s([])}catch(p){console.error("Error forcing reload from CSV:",p),n(p instanceof Error?p.message:"Failed to reload from CSV")}finally{a(!1)}},[]),l=u.useCallback(p=>p instanceof DOMException&&p.name==="QuotaExceededError"?"Storage quota exceeded. Please clear some data in Settings to free space.":p instanceof Error?p.name==="VersionError"||p.name==="InvalidStateError"?"Database version mismatch. Please reload the page to upgrade the database.":p.message:"An unexpected database error occurred",[]),i=u.useCallback(async p=>{try{n(null);const w=await F.getAll(),N=((w.length>0?Math.max(...w.map(E=>parseInt(E.id))):0)+1).toString().padStart(5,"0"),M={...p,id:N};return await F.add(M),s(E=>[...E,M]),M}catch(w){const v=l(w);throw n(v),console.error("Error adding song:",w),w}},[l]),m=u.useCallback(async p=>{try{n(null);const w=await F.getAll(),v=w.length>0?Math.max(...w.map(M=>parseInt(M.id))):0,N=p.map((M,E)=>({...M,id:M.id||(v+E+1).toString().padStart(5,"0")}));return await Promise.all(N.map(M=>F.add(M))),s(M=>[...M,...N]),N}catch(w){const v=l(w);throw n(v),console.error("Error adding songs:",w),w}},[l]),f=u.useCallback(async()=>{try{const p=await F.getAll();await Ae.exportSongsToCSV(p,"updated"),console.log("CSV files exported successfully")}catch(p){throw console.warn("Failed to export CSV files:",p),p}},[]),x=u.useCallback(async p=>{try{n(null),await F.update(p),s(w=>w.map(v=>v.id===p.id?p:v))}catch(w){const v=l(w);throw n(v),console.error("Error updating song:",w),w}},[l]),g=u.useCallback(async p=>{try{n(null),await F.delete(p),s(w=>w.filter(v=>v.id!==p));try{const w=await F.getAll();await Ae.exportSongsToCSV(w,"updated"),console.log("CSV files exported after deleting song")}catch(w){console.warn("Failed to export CSV files after deleting song:",w)}}catch(w){throw n(w instanceof Error?w.message:"Failed to delete song"),console.error("Error deleting song:",w),w}},[]),h=u.useCallback(async p=>{try{return n(null),await F.search(p)}catch(w){return n(w instanceof Error?w.message:"Failed to search songs"),console.error("Error searching songs:",w),[]}},[]),y=u.useCallback(async(p,w)=>{try{return n(null),await F.filterByBpm(p,w)}catch(v){return n(v instanceof Error?v.message:"Failed to filter songs by BPM"),console.error("Error filtering songs by BPM:",v),[]}},[]);return u.useEffect(()=>{c()},[c]),{songs:t,loading:r,error:o,addSong:i,addMultipleSongs:m,updateSong:x,deleteSong:g,searchSongs:h,filterByBpm:y,forceReloadFromCsv:d,exportCSVFiles:f,refresh:c}}function is(){const[t,s]=u.useState([]),[r,a]=u.useState(!0),[o,n]=u.useState(null),c=u.useCallback(async()=>{try{a(!0),n(null);const g=await R.getAll();s(g)}catch(g){n(g instanceof Error?g.message:"Failed to load projects"),console.error("Error loading projects:",g)}finally{a(!1)}},[]),d=u.useCallback(async g=>{try{n(null);const h={id:Date.now().toString(),name:g,createdAt:new Date};return await R.add(h),s(y=>[h,...y]),h}catch(h){throw n(h instanceof Error?h.message:"Failed to add project"),console.error("Error adding project:",h),h}},[]),l=u.useCallback(async g=>{try{n(null),await R.update(g),s(h=>h.map(y=>y.id===g.id?g:y))}catch(h){throw n(h instanceof Error?h.message:"Failed to update project"),console.error("Error updating project:",h),h}},[]),i=u.useCallback(async g=>{try{n(null),await R.delete(g),s(h=>h.filter(y=>y.id!==g))}catch(h){throw n(h instanceof Error?h.message:"Failed to delete project"),console.error("Error deleting project:",h),h}},[]),m=u.useCallback(async(g,h,y="Main")=>{try{n(null),await R.addSongToProject(g,h,y)}catch(p){throw n(p instanceof Error?p.message:"Failed to add song to project"),console.error("Error adding song to project:",p),p}},[]),f=u.useCallback(async(g,h)=>{try{n(null),await R.removeSongFromProject(g,h)}catch(y){throw n(y instanceof Error?y.message:"Failed to remove song from project"),console.error("Error removing song from project:",y),y}},[]),x=u.useCallback(async(g,h)=>{try{n(null),await R.reorderSongs(g,h)}catch(y){throw n(y instanceof Error?y.message:"Failed to reorder songs"),console.error("Error reordering songs:",y),y}},[]);return u.useEffect(()=>{c()},[c]),{projects:t,loading:r,error:o,addProject:d,updateProject:l,deleteProject:i,addSongToProject:m,removeSongFromProject:f,reorderSongs:x,refresh:c}}const Te=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],cs=(()=>{const t=[];for(let s=0;s<12;s++){t[s]=[];for(let r=0;r<12;r++){const a=Math.abs(s-r);t[s][r]=Math.min(a,12-a)}}return t})();function q(t){const r=t.replace(/\s+(Major|Minor)/gi,"").trim().replace(/Db/g,"C#").replace(/Eb/g,"D#").replace(/Gb/g,"F#").replace(/Ab/g,"A#").replace(/Bb/g,"A#"),a=Te.indexOf(r);if(a===-1)throw new Error(`Unknown key: ${t}. Supported keys: ${Te.join(", ")}`);return a}function ls(t,s){const r=q(t),a=new Set;for(let o=-s;o<=s;o++){const n=(r+o+12)%12;a.add(n)}return a}function ot(t,s,r){try{const a=ls(s,r);return t.some(o=>{try{const n=q(o);return a.has(n)}catch{return!1}})}catch{return!1}}function ds(t,s,r){try{const a=q(t),o=q(s);return Math.min(Math.abs(a-o),12-Math.abs(a-o))<=r}catch{return!1}}function it(t){if(!t||typeof t!="string")return null;try{const s=t.trim();if(!s)return null;const r=/\b(major|maj|M)\b/i.exec(s),a=/\b(minor|min|m)\b/i.exec(s);let o=null;r?o="major":a&&(o="minor");const c=s.replace(/\s+(Major|Minor|Maj|Min|M|m)\b/gi,"").trim().replace(/Db/gi,"C#").replace(/Eb/gi,"D#").replace(/Gb/gi,"F#").replace(/Ab/gi,"A#").replace(/Bb/gi,"A#").replace(/Cb/gi,"B").replace(/Fb/gi,"E").replace(/E#/gi,"F").replace(/B#/gi,"C"),d=Te.findIndex(l=>l.toLowerCase()===c.toLowerCase());return d===-1?null:{pitchClass:d,mode:o}}catch{return null}}function Ne(t,s){const r=it(t),a=it(s);if(!r||!a)return 0;if(r.pitchClass===a.pitchClass&&r.mode===a.mode)return 1;let c=1-cs[r.pitchClass][a.pitchClass]/6;return r.pitchClass===a.pitchClass&&r.mode!==a.mode&&r.mode!==null&&a.mode!==null&&(c=1-.15),Math.max(0,Math.min(1,c))}function ct(t,s,r){try{const a=q(t),o=q(s),n=q(r);let c=a;for(let d=0;d<12;d++){if(c===n)return!0;if(c===o)return!1;c=(c+1)%12}return!1}catch{return!1}}function ms(t,s,r){return t.some(a=>a>=s-r&&a<=s+r)}function gs(t,s,r){if(t.length===0)return 0;const a=t.reduce((o,n)=>{const c=Math.abs(n-s);return c<o?c:o},1/0);return a>r?0:Math.max(0,1-a/(15*1.5))}function lt(t,s,r=5){const a=t/s,o=s/t;return[2,3,4,1.5,.5,.75,1.33].some(c=>Math.abs(a-c)<r||Math.abs(o-c)<r)}const us={Intro:["Intro","Intro 1","Intro 2","Intro Drop","Intro Drop 1","Intro Drop 2"],Verse:["Verse","Verse A","Verse B","Verse C","Verse 2"],Prechorus:["Prechorus","Prechorus A","Prechorus B","Prechorus C"],Chorus:["Chorus","Chorus A","Chorus B","Chorus 2","Last Chorus","Last Postchorus","Postchorus"],Bridge:["Bridge"],Other:[]},le=new Map;function K(t){if(!t||typeof t!="string")return"Other";const s=t.trim().toLowerCase();if(s==="")return"Other";if(le.has(s))return le.get(s);for(const[r,a]of Object.entries(us))if(r!=="Other"){for(const o of a)if(o.toLowerCase()===s)return le.set(s,r),r}return le.set(s,"Other"),"Other"}class Ce{static sectionMatchesPartFilter(s,r){if(r.part){const a=K(s.part),o=K(r.part);if(a!==o)return!1}if(r.bpm){if(r.bpm.mode==="target"&&r.bpm.target!==void 0&&r.bpm.tolerance!==void 0){const a=typeof r.bpm.target=="number"?r.bpm.target:void 0;if(a===void 0)return!1;const o=a-r.bpm.tolerance,n=a+r.bpm.tolerance;if(s.bpm<o||s.bpm>n)return!1}else if(r.bpm.mode==="range"){const a=r.bpm.min??0,o=r.bpm.max??999;if(s.bpm<a||s.bpm>o)return!1}}return!(r.key&&Array.isArray(r.key)&&r.key.length>0&&!r.key.includes(s.key))}static songMatchesPartFiltersSync(s,r){if(!r||r.length===0)return!0;for(const a of r)if(!s.some(n=>this.sectionMatchesPartFilter(n,a)))return!1;return!0}static async findMatches(s,r){const a=s.filter(c=>{if(r.searchText){const d=r.searchText.toLowerCase();if(!c.title.toLowerCase().includes(d))return!1}if(r.artist){const d=r.artist.toLowerCase();if(!c.artist.toLowerCase().includes(d))return!1}if(r.origin){const d=r.origin.toLowerCase();if(!c.origin?.toLowerCase().includes(d))return!1}if(r.season){const d=r.season.toLowerCase();if(!c.season?.toLowerCase().includes(d))return!1}if(r.type&&!c.type.toLowerCase().includes(r.type.toLowerCase()))return!1;if(r.yearRange){const[d,l]=r.yearRange;if(c.year<d||c.year>l)return!1}if(r.bpmRange){const[d,l]=r.bpmRange;if(!c.bpms.some(i=>i>=d&&i<=l))return!1}if(r.selectedKeys&&r.selectedKeys.length>0){if(!c.keys.some(l=>r.selectedKeys.some(i=>l===i)))return!1}else if(r.keyRangeStart&&r.keyRangeEnd){if(!c.keys.some(l=>ct(r.keyRangeStart,r.keyRangeEnd,l)))return!1}else if(r.targetKey&&r.keyTolerance!==void 0&&!ot(c.keys,r.targetKey,r.keyTolerance))return!1;return!0});let o=a;if(r.partSpecificFilters&&r.partSpecificFilters.length>0){const c=a.map(i=>i.id),d=await j.songSections.where("songId").anyOf(c).toArray(),l=new Map;for(const i of d){const m=l.get(i.songId)??[];m.push(i),l.set(i.songId,m)}o=a.filter(i=>this.songMatchesPartFiltersSync(l.get(i.id)??[],r.partSpecificFilters))}if(r.partSpecificKey&&r.partSpecificKey.section&&r.partSpecificKey.key){const c=K(r.partSpecificKey.section),d=o.map(m=>m.id),l=await j.songSections.where("songId").anyOf(d).toArray(),i=new Map;for(const m of l){const f=i.get(m.songId)??[];f.push(m),i.set(m.songId,f)}o=o.filter(m=>{const x=(i.get(m.id)??[]).find(h=>K(h.part)===c);return x?(x.key.includes(",")?x.key.split(",").map(h=>h.trim()).filter(Boolean):[x.key.trim()]).some(h=>h===r.partSpecificKey.key):!1})}return o.map(c=>this.evaluateMatch(c,r)).sort((c,d)=>d.matchScore-c.matchScore)}static evaluateMatch(s,r){let a=0,o=0,n=0;const c=[];if(r.targetBpm&&r.bpmTolerance!==void 0)ms(s.bpms,r.targetBpm,r.bpmTolerance)&&(o=gs(s.bpms,r.targetBpm,r.bpmTolerance),a+=o*et,c.push(`BPM match: ${s.bpms.join(", ")} within ±${r.bpmTolerance} of ${r.targetBpm}`));else if(r.bpmRange){const[d,l]=r.bpmRange;s.bpms.some(i=>i>=d&&i<=l)&&(o=.8,a+=o*et,c.push(`BPM in range: ${d}-${l}`))}if(r.selectedKeys&&r.selectedKeys.length>0?s.keys.some(l=>r.selectedKeys.some(i=>l===i))&&(n=1,a+=n*ve,c.push(`Key match: ${s.keys.join(", ")} matches selected keys`)):r.keyRangeStart&&r.keyRangeEnd?s.keys.some(d=>ct(r.keyRangeStart,r.keyRangeEnd,d))&&(n=1,a+=n*ve,c.push(`Key in range: ${r.keyRangeStart} → ${r.keyRangeEnd}`)):r.targetKey&&r.keyTolerance!==void 0&&ot(s.keys,r.targetKey,r.keyTolerance)&&(n=1,a+=n*ve,c.push(`Key match: ${s.keys.join(", ")} compatible with ${r.targetKey}`)),r.type&&s.type.toLowerCase().includes(r.type.toLowerCase())&&(a+=Mr,c.push(`Type match: ${s.type}`)),r.yearRange){const[d,l]=r.yearRange;s.year>=d&&s.year<=l&&(a+=Er,c.push(`Year match: ${s.year}`))}if(r.searchText){const d=r.searchText.toLowerCase();s.title.toLowerCase().includes(d)&&(a+=Ar,c.push(`Title contains: "${r.searchText}"`))}return{...s,matchScore:a,bpmScore:o,keyScore:n,reasons:c}}static findHarmonicMatches(s,r,a){const o=[];for(const n of s){if(n.id===r.id)continue;let c=0;const d=[],l=n.bpms.some(m=>r.bpms.some(f=>lt(m,f,a.bpm)));l&&(c+=.5,d.push("Harmonic BPM relationship detected"));const i=n.keys.some(m=>r.keys.some(f=>ds(m,f,a.key)));i&&(c+=.3,d.push("Compatible key detected")),n.type===r.type&&(c+=.1,d.push("Same type")),c>0&&o.push({...n,matchScore:c,bpmScore:l?.5:0,keyScore:i?.3:0,reasons:d})}return o.sort((n,c)=>c.matchScore-n.matchScore)}static async calculatePartSpecificKeyScore(s,r,a,o){let n=a,c=o;if((!n||n.length===0)&&(n=await j.songSections.where("songId").equals(s.id).toArray()),(!c||c.length===0)&&(c=await j.songSections.where("songId").equals(r.id).toArray()),n.length===0)return 0;const d=c.length===0||c.length===1&&(c[0].part.toLowerCase().includes("full song")||c[0].part.toLowerCase()==="full"||c[0].part.toLowerCase().trim()===""),l=[];for(const m of n){let f=0;if(!m.key||m.key.trim()===""){l.push(0);continue}if(d&&c.length===1){const x=c[0].key;x&&x.trim()!==""&&(f=Ne(m.key,x))}else{const x=K(m.part),g=c.find(h=>K(h.part)===x);if(g&&g.key&&g.key.trim()!==""){const h=m.key.trim(),y=g.key.trim(),p=h.includes(",")?h.split(",").map(N=>N.trim()).filter(N=>N):[h],w=y.includes(",")?y.split(",").map(N=>N.trim()).filter(N=>N):[y];let v=0;for(const N of p)for(const M of w){const E=Ne(N,M);v=Math.max(v,E)}f=v}}l.push(f)}if(l.length===0)return 0;const i=l.reduce((m,f)=>m+f,0)/l.length;return Math.max(0,Math.min(1,i))}static async getQuickMatches(s,r){const a=await j.songSections.where("songId").equals(r.id).toArray();if(a.length===0)return this.findHarmonicMatches(s,r,{bpm:tt,key:2});const o=s.map(l=>l.id).filter(l=>l!==r.id),n=await j.songSections.where("songId").anyOf(o).toArray(),c=new Map;for(const l of n){const i=c.get(l.songId)??[];i.push(l),c.set(l.songId,i)}const d=[];for(const l of s){if(l.id===r.id)continue;const i=c.get(l.id)??[];let m=0,f=0,x=0;const g=[],h=await this.calculatePartSpecificKeyScore(r,l,a,i);if(h>0){m+=h*Tr,x=h;const w=[];for(const v of a){const N=i.find(M=>M.part.toLowerCase()===v.part.toLowerCase());if(N){const M=Ne(v.key,N.key);if(M>0){const E=Math.round(M*100);w.push(`${v.part}: ${E}% match (${v.key} vs ${N.key})`)}}}g.push(w.length>0?`Part-specific key match: ${w.join(", ")}`:`Part-specific key match: ${Math.round(h*100)}% similarity`)}let y=0;const p=[];for(const w of a){const v=K(w.part),N=i.find(M=>K(M.part)===v);if(N&&lt(N.bpm,w.bpm,tt)){const E=Math.abs(N.bpm-w.bpm),_=Math.max(0,1-E/22.5);y=Math.max(y,_),p.push(`${w.part}: ${N.bpm} BPM matches ${w.bpm} BPM`)}}y>0&&(m+=y*Pr,f=y,g.push(`Part-specific BPM match: ${p.join(", ")}`)),l.artist.toLowerCase()===r.artist.toLowerCase()&&(m+=Fr,g.push(`Artist match: ${l.artist}`)),l.origin&&r.origin&&l.origin.toLowerCase()===r.origin.toLowerCase()&&(m+=Lr,g.push(`Origin match: ${l.origin}`)),m>0&&d.push({...l,matchScore:m,bpmScore:f,keyScore:x,reasons:g})}return d.sort((l,i)=>i.matchScore-l.matchScore)}}function $e(t){return!t||t.mode===null?!1:t.mode==="target"?t.target!==void 0&&t.tolerance!==void 0:t.mode==="range"?t.min!==void 0||t.max!==void 0:!1}function Pe(t,s){const r={...t,...s};return r.mode==="range"||r.min!==void 0||r.max!==void 0?(r.mode="range",r.target=void 0,r.tolerance=void 0):(r.mode==="target"||r.target!==void 0&&r.tolerance!==void 0)&&(r.mode="target",r.min=void 0,r.max=void 0),r}function Fe(t){const s={};return t.bpm.mode==="target"&&t.bpm.target!==void 0&&t.bpm.tolerance!==void 0?(s.targetBpm=typeof t.bpm.target=="number"?t.bpm.target:void 0,s.bpmTolerance=t.bpm.tolerance):t.bpm.mode==="range"&&(s.bpmRange=[t.bpm.min??0,t.bpm.max??999]),t.key&&t.key.length>0&&(s.selectedKeys=t.key),(t.year.min!==void 0||t.year.max!==void 0)&&(s.yearRange=[t.year.min??1900,t.year.max??2030]),t.advanced.type&&(s.type=t.advanced.type),t.advanced.origin&&(s.origin=t.advanced.origin),t.advanced.season&&(s.season=t.advanced.season),t.advanced.artist&&(s.artist=t.advanced.artist),t.advanced.text&&(s.searchText=t.advanced.text),t.advanced.partSpecific&&t.advanced.partSpecific.length>0&&(s.partSpecificFilters=t.advanced.partSpecific),t.advanced.partSpecificKey&&t.advanced.partSpecificKey.section&&t.advanced.partSpecificKey.key&&(s.partSpecificKey=t.advanced.partSpecificKey),s}function Le(){return{bpm:{mode:null},key:[],year:{},advanced:{partSpecific:[],partSpecificKey:null}}}function hs(t){if(!t.part)return!1;const s=!!(t.bpm&&$e(t.bpm)),r=!!(t.key&&Array.isArray(t.key)&&t.key.length>0);return s||r}const ps=Object.freeze(Object.defineProperty({__proto__:null,createDefaultFilterState:Le,enforceBpmExclusivity:Pe,filterStateToMatchCriteria:Fe,hasHarmonicValues:$e,isFilterBlockComplete:hs},Symbol.toStringTag,{value:"Module"}));function xs({value:t,onChange:s,onClear:r}){const[a,o]=u.useState(!1),n=u.useRef(null);u.useEffect(()=>{function x(g){n.current&&!n.current.contains(g.target)&&o(!1)}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const c=$e(t),d=t.mode==="range"||t.min!==void 0||t.max!==void 0,l=t.mode==="target"||t.target!==void 0&&t.tolerance!==void 0,i=(x,g)=>{const h=Pe(t,{mode:"target",target:x,tolerance:g??10});s(h)},m=(x,g)=>{const h=Pe(t,{mode:"range",min:x,max:g});s(h)},f=()=>{if(l&&t.target!==void 0&&t.tolerance!==void 0)return`${t.target} ±${t.tolerance}`;if(d&&(t.min!==void 0||t.max!==void 0)){const x=t.min??0,g=t.max??999;return`${x}-${g}`}return"BPM"};return e.jsxs("div",{className:"relative",ref:n,children:[e.jsxs("button",{type:"button",onClick:()=>o(!a),className:`flex items-center justify-between px-4 py-2 border rounded-md text-sm font-medium transition-colors ${c?"bg-primary-50 border-primary-300 text-primary-700 dark:bg-primary-900/20 dark:border-primary-700 dark:text-primary-300":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700"}`,"aria-expanded":a,"aria-haspopup":"true",children:[e.jsx("span",{children:f()}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c&&e.jsx("button",{type:"button",onClick:x=>{x.stopPropagation(),r()},className:"p-0.5 hover:bg-primary-100 dark:hover:bg-primary-800 rounded","aria-label":"Clear BPM filter",children:e.jsx(Y,{size:14})}),e.jsx(me,{size:16,className:a?"transform rotate-180":""})]})]}),a&&e.jsx("div",{className:"absolute z-50 mt-2 w-80 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Target BPM ± Tolerance"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"number",value:l?t.target??"":"",onChange:x=>{const g=x.target.value?parseInt(x.target.value):void 0;i(g,t.tolerance)},disabled:d,className:`w-full px-3 py-2 border rounded-md text-sm ${d?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700 dark:text-gray-500":"border-gray-300 focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300"}`,placeholder:"Target BPM",min:"60",max:"300"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:["Tolerance: ±",l?t.tolerance??10:10]}),e.jsx("input",{type:"range",min:"1",max:"50",value:l?t.tolerance??10:10,onChange:x=>{const g=parseInt(x.target.value);i(t.target,g)},disabled:d,className:`w-full ${d?"opacity-50 cursor-not-allowed":""}`})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"BPM Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:d?t.min??"":"",onChange:x=>{const g=x.target.value?parseInt(x.target.value):void 0;m(g,t.max)},disabled:l,className:`px-3 py-2 border rounded-md text-sm ${l?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700 dark:text-gray-500":"border-gray-300 focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300"}`,placeholder:"Min BPM",min:"40",max:"400"}),e.jsx("input",{type:"number",value:d?t.max??"":"",onChange:x=>{const g=x.target.value?parseInt(x.target.value):void 0;m(t.min,g)},disabled:l,className:`px-3 py-2 border rounded-md text-sm ${l?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700 dark:text-gray-500":"border-gray-300 focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300"}`,placeholder:"Max BPM",min:"40",max:"400"})]})]})]})})]})}const ys=["C Major","C# Major","D Major","D# Major","E Major","F Major","F# Major","G Major","G# Major","A Major","A# Major","B Major"];function fs({value:t,onChange:s,onClear:r}){const[a,o]=u.useState(!1),n=u.useRef(null);u.useEffect(()=>{function i(m){n.current&&!n.current.contains(m.target)&&o(!1)}return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const c=t&&t.length>0,d=i=>{t.includes(i)?s(t.filter(m=>m!==i)):s([...t,i])},l=()=>c?t.length===1?t[0]:`${t.length} keys selected`:"Key";return e.jsxs("div",{className:"relative",ref:n,children:[e.jsxs("button",{type:"button",onClick:()=>o(!a),className:`flex items-center justify-between px-4 py-2 border rounded-md text-sm font-medium transition-colors ${c?"bg-primary-50 border-primary-300 text-primary-700 dark:bg-primary-900/20 dark:border-primary-700 dark:text-primary-300":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700"}`,"aria-expanded":a,"aria-haspopup":"true",children:[e.jsx("span",{children:l()}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c&&e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),r()},className:"p-0.5 hover:bg-primary-100 dark:hover:bg-primary-800 rounded","aria-label":"Clear Key filter",children:e.jsx(Y,{size:14})}),e.jsx(me,{size:16,className:a?"transform rotate-180":""})]})]}),a&&e.jsx("div",{className:"absolute z-50 mt-2 w-64 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Keys"}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:ys.map(i=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:t.includes(i),onChange:()=>d(i),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i})]},i))}),c&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:r,className:"text-xs text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300",children:"Clear all"})})]})})]})}function bs({min:t,max:s,onChange:r,onClear:a}){const[o,n]=u.useState(!1),c=u.useRef(null);u.useEffect(()=>{function i(m){c.current&&!c.current.contains(m.target)&&n(!1)}return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const d=t!==void 0||s!==void 0,l=()=>t!==void 0&&s!==void 0?`${t} - ${s}`:t!==void 0?`${t}+`:s!==void 0?`-${s}`:"Period";return e.jsxs("div",{className:"relative",ref:c,children:[e.jsxs("button",{type:"button",onClick:()=>n(!o),className:`flex items-center justify-between px-4 py-2 border rounded-md text-sm font-medium transition-colors ${d?"bg-primary-50 border-primary-300 text-primary-700 dark:bg-primary-900/20 dark:border-primary-700 dark:text-primary-300":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700"}`,"aria-expanded":o,"aria-haspopup":"true",children:[e.jsx("span",{children:l()}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),a()},className:"p-0.5 hover:bg-primary-100 dark:hover:bg-primary-800 rounded","aria-label":"Clear Year filter",children:e.jsx(Y,{size:14})}),e.jsx(me,{size:16,className:o?"transform rotate-180":""})]})]}),o&&e.jsx("div",{className:"absolute z-50 mt-2 w-64 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg p-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Year Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:t??"",onChange:i=>{const m=i.target.value?parseInt(i.target.value):void 0;r(m,s)},className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300",placeholder:"Min Year",min:"1900",max:"2030"}),e.jsx("input",{type:"number",value:s??"",onChange:i=>{const m=i.target.value?parseInt(i.target.value):void 0;r(t,m)},className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300",placeholder:"Max Year",min:"1900",max:"2030"})]})]})})]})}const ws=["Winter","Spring","Summer","Fall"];function js({value:t,onChange:s,onClear:r}){const[a,o]=u.useState(!1),n=u.useRef(null);u.useEffect(()=>{function i(m){n.current&&!n.current.contains(m.target)&&o(!1)}return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const c=t!==void 0&&t!=="",d=i=>{s(t===i?void 0:i),o(!1)},l=()=>c?t:"Season";return e.jsxs("div",{className:"relative",ref:n,children:[e.jsxs("button",{type:"button",onClick:()=>o(!a),className:`flex items-center justify-between px-4 py-2 border rounded-md text-sm font-medium transition-colors ${c?"bg-primary-50 border-primary-300 text-primary-700 dark:bg-primary-900/20 dark:border-primary-700 dark:text-primary-300":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700"}`,"aria-expanded":a,"aria-haspopup":"true",children:[e.jsx("span",{children:l()}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c&&e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),r()},className:"p-0.5 hover:bg-primary-100 dark:hover:bg-primary-800 rounded","aria-label":"Clear Season filter",children:e.jsx(Y,{size:14})}),e.jsx(me,{size:16,className:a?"transform rotate-180":""})]})]}),a&&e.jsx("div",{className:"absolute z-50 mt-2 w-48 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg p-2",children:e.jsx("div",{className:"space-y-1",children:ws.map(i=>e.jsx("button",{type:"button",onClick:()=>d(i),className:`w-full text-left px-3 py-2 text-sm rounded-md transition-colors ${t===i?"bg-primary-100 text-primary-700 dark:bg-primary-900/30 dark:text-primary-300":"text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:i},i))})})]})}function ks({filterState:t,onFilterChange:s,onAdvancedFiltersClick:r,onApplyFilters:a}){const o=async g=>{if(s(g),a){const{filterStateToMatchCriteria:h}=await B(async()=>{const{filterStateToMatchCriteria:p}=await Promise.resolve().then(()=>ps);return{filterStateToMatchCriteria:p}},void 0),y=h(g);await a(y)}},n=async g=>{await o({...t,bpm:g})},c=async()=>{await o({...t,bpm:{mode:null}})},d=async g=>{await o({...t,key:g})},l=async()=>{await o({...t,key:[]})},i=async(g,h)=>{await o({...t,year:{min:g,max:h}})},m=async()=>{await o({...t,year:{}})},f=async g=>{await o({...t,advanced:{...t.advanced,season:g}})},x=async()=>{await o({...t,advanced:{...t.advanced,season:void 0}})};return e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Filter:"}),e.jsx(xs,{value:t.bpm,onChange:n,onClear:c}),e.jsx(fs,{value:t.key,onChange:d,onClear:l}),e.jsx(bs,{min:t.year.min,max:t.year.max,onChange:i,onClear:m}),e.jsx(js,{value:t.advanced.season,onChange:f,onClear:x}),e.jsxs("button",{type:"button",onClick:r,className:"flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(ge,{size:16,className:"mr-2"}),"Advanced Filters"]})]})}const vs=u.createContext(void 0);function Ss({children:t,songs:s}){const[r,a]=u.useState(null);return e.jsx(vs.Provider,{value:{activeSong:r,setActiveSong:a},children:e.jsxs(ur,{collisionDetection:hr,onDragStart:o,onDragOver:n,onDragEnd:c,children:[t,e.jsx(pr,{children:r?e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg border-2 border-primary-500 opacity-90",children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.title}),e.jsx("div",{className:"text-sm text-gray-500",children:r.artist}),e.jsxs("div",{className:"text-xs text-gray-400",children:[r.primaryBpm||r.bpms[0]," BPM, ",r.primaryKey||r.keys[0]]})]}):null})]})});function o(d){const{active:l}=d,i=s.find(m=>m.id===l.id);a(i||null)}function n(){}function c(d){const{over:l}=d;if(!l){a(null);return}if(l.id==="project-list")console.log("Dropped on project list");else if(l.id.toString().startsWith("project-")){const i=l.id.toString().replace("project-","");console.log("Dropped on project:",i)}else if(l.id.toString().startsWith("section-")){const[i,m]=l.id.toString().replace("section-","").split("-");console.log("Dropped on section:",i,m)}a(null)}}function Ns({query:t,suggestions:s,onSelect:r,onClose:a,isVisible:o}){const[n,c]=u.useState(-1),d=u.useRef(null);u.useEffect(()=>{c(-1)},[t]),u.useEffect(()=>{if(n>=0&&d.current){const i=d.current.children[n];i&&i.scrollIntoView({block:"nearest"})}},[n]);const l=i=>{if(o)switch(i.key){case"ArrowDown":i.preventDefault(),c(m=>m<s.length-1?m+1:0);break;case"ArrowUp":i.preventDefault(),c(m=>m>0?m-1:s.length-1);break;case"Enter":i.preventDefault(),n>=0&&n<s.length&&r(s[n]);break;case"Escape":i.preventDefault(),a();break}};return!o||s.length===0?null:e.jsxs("div",{ref:d,className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-50 max-h-60 overflow-y-auto",onKeyDown:l,children:[s.map((i,m)=>e.jsxs("div",{className:`px-4 py-2 cursor-pointer flex items-center space-x-3 ${m===n?"bg-primary-50 text-primary-900":"hover:bg-gray-50"}`,onClick:()=>r(i),children:[e.jsx(Ie,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"text-sm",children:i})]},m)),s.length>0&&e.jsx("div",{className:"px-4 py-2 border-t border-gray-200 bg-gray-50 text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zt,{size:12}),e.jsx("span",{children:"Use ↑↓ to navigate, Enter to select, Esc to close"})]})})]})}const vt={keys:[{name:"title",weight:.4},{name:"artist",weight:.3},{name:"type",weight:.15},{name:"origin",weight:.1},{name:"part",weight:.05}],threshold:Nr,distance:Cr,includeScore:!0,includeMatches:!0,minMatchCharLength:ut,shouldSort:!0,findAllMatches:!0,ignoreLocation:!0,useExtendedSearch:!0};let W=null;function Cs(t){W=new gt(t,vt)}function Is(t){if(!W){W=new gt(t,vt);return}W.setCollection(t)}function de(t,s){return!W||!t.trim()?[]:W.search(t).slice(0,s??Ir)}function Ms(t,s=5){if(t.length<ut)return[];const r=de(t,s),a=new Set,o=t.toLowerCase();for(const n of r)if(n.item.title.toLowerCase().includes(o)&&a.add(n.item.title),n.item.artist.toLowerCase().includes(o)&&a.add(n.item.artist),n.item.type.toLowerCase().includes(o)&&a.add(n.item.type),a.size>=s)break;return Array.from(a).slice(0,s)}function Es(t,s){const[r,a]=u.useState(t);return u.useEffect(()=>{const o=setTimeout(()=>{a(t)},s);return()=>{clearTimeout(o)}},[t,s]),r}const As=u.memo(function({songs:s,onSearch:r,onClear:a,placeholder:o="Search songs..."}){const[n,c]=u.useState(""),[d,l]=u.useState([]),[i,m]=u.useState(!1),[f,x]=u.useState([]),[g,h]=u.useState([]),y=u.useRef(null),p=Es(n,300),w=u.useRef(!1);u.useEffect(()=>{s.length!==0&&(w.current?Is(s):(Cs(s),w.current=!0))},[s]),u.useEffect(()=>{const b=localStorage.getItem("recentSearches");if(b)try{x(JSON.parse(b))}catch{x([])}},[]);const v=b=>{if(!b.trim())return;const C=[b,...f.filter(P=>P!==b)].slice(0,5);x(C),localStorage.setItem("recentSearches",JSON.stringify(C))},N=b=>{const C=b.target.value;c(C),C.trim().length<2&&(a(),l([]),m(!1),h([]))};u.useEffect(()=>{if(p.trim().length>=2){const b=de(p);h(b),r(b);const C=Ms(p);l(C),m(!0)}},[p,r]);const M=b=>{c(b),m(!1),v(b);const C=de(b);h(C),r(C)},E=b=>{if(b.preventDefault(),n.trim()){v(n),m(!1);const C=de(n);h(C),r(C)}},_=()=>{c(""),l([]),m(!1),h([]),a(),y.current?.focus()},U=b=>{b.key==="Escape"&&(m(!1),y.current?.blur())},L=g.length>0,T=g[0],k=g.reduce((b,C)=>{const P=C.item.type||"Other";return b[P]=(b[P]??0)+1,b},{}),A=i?d:f.filter(b=>b.toLowerCase().includes(n.toLowerCase()));return e.jsxs("div",{className:"search-container",children:[e.jsx("form",{onSubmit:E,className:"relative",children:e.jsxs("div",{className:"relative group",children:[e.jsx(Ie,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 group-focus-within:text-primary-500 transition-colors duration-200",size:18,"aria-hidden":"true"}),e.jsx("input",{ref:y,type:"text",value:n,onChange:N,onKeyDown:U,onFocus:()=>m(!0),className:"search-input h-11 md:h-12 text-base",placeholder:o,"aria-label":"Search songs","aria-autocomplete":"list","aria-controls":"search-suggestions","aria-expanded":i&&A.length>0}),e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-2",children:[n&&e.jsx("button",{type:"button",onClick:_,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200","aria-label":"Clear search",children:e.jsx(Y,{size:16,"aria-hidden":"true"})}),e.jsx("button",{type:"submit",className:"p-2 text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-lg transition-all duration-200","aria-label":"Submit search",children:e.jsx(Ie,{size:16,"aria-hidden":"true"})})]})]})}),e.jsx(Ns,{query:n,suggestions:A,onSelect:M,onClose:()=>m(!1),isVisible:i}),L&&e.jsx("div",{className:"mt-4 animate-slide-down","aria-live":"polite","aria-atomic":"true",children:e.jsx("div",{className:"card p-4 bg-gradient-to-r from-primary-50 to-accent-purple-50 dark:from-primary-900/20 dark:to-accent-purple-900/20 border-primary-200 dark:border-primary-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{size:18,className:"text-primary-600 dark:text-primary-400","aria-hidden":"true"}),e.jsxs("span",{className:"text-sm font-semibold text-primary-900 dark:text-primary-100",children:[g.length," result",g.length!==1?"s":""," found"]})]}),T&&e.jsxs("div",{className:"text-sm text-primary-700 dark:text-primary-300",children:["Best match: ",e.jsx("span",{className:"font-medium",children:T.item.title}),e.jsxs("span",{className:"ml-2 text-xs bg-primary-100 dark:bg-primary-800 text-primary-800 dark:text-primary-200 px-2 py-1 rounded-full",children:[Math.round((1-(T.score??0))*100),"% match"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:Object.entries(k).map(([b,C])=>e.jsxs("span",{className:"badge badge-primary",children:[b,": ",C]},b))})]})})})]})}),Ts=25,Ps=u.memo(function({results:s,onEditSong:r,onDeleteSong:a,onAddToProject:o,onSongClick:n}){const[c,d]=u.useState(1),[l,i]=u.useState(Ts),m=jt();u.useEffect(()=>{d(1)},[s.length,l]);const f=(c-1)*l,x=f+l,g=s.slice(f,x),{getCoverImage:h}=yt(g);return s.length===0?e.jsxs("div",{className:"text-center py-12 flex flex-col items-center justify-center",children:[e.jsx(O,{size:48,className:"mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-center",children:"No songs found"}),e.jsx("p",{className:"text-sm text-gray-400 text-center",children:"Try adjusting your search terms"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Search Results (",s.length,")"]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(_e,{size:16}),e.jsx("span",{children:"Sorted by relevance"})]})]}),m?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-music-electric/10 via-music-cosmic/10 to-music-neon/10 dark:from-music-electric/20 dark:via-music-cosmic/20 dark:to-music-neon/20 text-gray-700 dark:text-gray-300 font-bold",children:[e.jsx("th",{className:"px-3 py-3 text-center align-middle w-16 hidden sm:table-cell",children:e.jsx("span",{children:"Artwork"})}),e.jsx("th",{className:"px-3 py-3 text-center align-middle w-28 sm:w-32 md:w-40 lg:w-48",children:e.jsx("span",{children:"Artist"})}),e.jsx("th",{className:"px-3 py-3 text-center align-middle w-40 sm:w-52 md:w-60 lg:w-64",children:e.jsx("span",{children:"Song"})}),e.jsx("th",{className:"px-4 py-3 text-center align-middle hidden md:table-cell w-36",children:e.jsx("span",{children:"Key"})}),e.jsx("th",{className:"px-4 py-3 text-center align-middle hidden sm:table-cell w-24",children:e.jsx("span",{children:"BPM"})}),e.jsx("th",{className:"px-4 py-3 text-center align-middle hidden lg:table-cell w-24",children:e.jsx("span",{children:"Year"})}),e.jsx("th",{className:"px-4 py-3 text-center align-middle hidden xl:table-cell w-28",children:e.jsx("div",{className:"flex items-center justify-center space-x-2",children:e.jsx("span",{children:"Actions"})})})]})}),e.jsx("tbody",{children:g.map((y,p)=>{const w=y.primaryKey||y.keys[0]||"",v=T=>({"C Major":"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 dark:border-red-500","C# Major":"bg-red-100 dark:bg-red-900/30 border-l-4 border-red-500 dark:border-red-400","D Major":"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-400 dark:border-orange-500","D# Major":"bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 dark:border-yellow-500","E Major":"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-400 dark:border-green-500","F Major":"bg-green-100 dark:bg-green-900/30 border-l-4 border-green-600 dark:border-green-400","F# Major":"bg-sky-50 dark:bg-sky-900/20 border-l-4 border-sky-300 dark:border-sky-400","G Major":"bg-sky-100 dark:bg-sky-900/30 border-l-4 border-sky-400 dark:border-sky-300","G# Major":"bg-violet-50 dark:bg-violet-900/20 border-l-4 border-violet-500 dark:border-violet-400","A Major":"bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-400 dark:border-purple-500","A# Major":"bg-orange-100 dark:bg-orange-900/30 border-l-4 border-orange-500 dark:border-orange-400","B Major":"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 dark:border-blue-400","C Minor":"bg-red-100 dark:bg-red-900/30 border-l-4 border-red-600 dark:border-red-500","C# Minor":"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 dark:border-red-400","D Minor":"bg-orange-100 dark:bg-orange-900/30 border-l-4 border-orange-500 dark:border-orange-400","D# Minor":"bg-yellow-100 dark:bg-yellow-900/30 border-l-4 border-yellow-500 dark:border-yellow-400","E Minor":"bg-green-100 dark:bg-green-900/30 border-l-4 border-green-500 dark:border-green-400","F Minor":"bg-green-50 dark:bg-green-900/20 border-l-4 border-green-700 dark:border-green-500","F# Minor":"bg-sky-100 dark:bg-sky-900/30 border-l-4 border-sky-400 dark:border-sky-300","G Minor":"bg-sky-50 dark:bg-sky-900/20 border-l-4 border-sky-500 dark:border-sky-400","G# Minor":"bg-violet-100 dark:bg-violet-900/30 border-l-4 border-violet-600 dark:border-violet-500","A Minor":"bg-purple-100 dark:bg-purple-900/30 border-l-4 border-purple-500 dark:border-purple-400","A# Minor":"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-600 dark:border-orange-500","B Minor":"bg-blue-100 dark:bg-blue-900/30 border-l-4 border-blue-600 dark:border-blue-500"})[T]||"bg-gray-50 dark:bg-gray-800/50 border-l-4 border-gray-300 dark:border-gray-600",N=()=>"text-gray-900 dark:text-gray-100",M=v(w),E=N(),_=h(y.id),L=(()=>{if(y.score===void 0)return null;const T=Math.round((1-y.score)*100);let k="text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700";return T>=80?k="text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30":T>=60&&(k="text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30"),{percentage:T,colorClass:k}})();return e.jsxs("tr",{className:`table-row group ${M} ${E} hover:opacity-90 transition-opacity cursor-pointer`,style:{animationDelay:`${p*.05}s`},onClick:()=>n?.(y),children:[e.jsx("td",{className:"px-3 py-3 align-middle w-16 hidden sm:table-cell",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(Be,{imageUrl:_??void 0,alt:`${y.title} by ${y.artist}`,size:"small",aspectRatio:"square"})})}),e.jsx("td",{className:"px-3 py-3 text-center align-middle w-28 sm:w-32 md:w-40 lg:w-48",children:e.jsx("div",{className:`text-base font-semibold break-words whitespace-normal ${E}`,title:y.artist,children:y.artist})}),e.jsxs("td",{className:"px-3 py-3 text-center align-middle w-40 sm:w-52 md:w-60 lg:w-64",children:[e.jsx("div",{className:`text-base font-bold break-words whitespace-normal ${E}`,title:y.title,children:y.title}),y.part&&e.jsx("div",{className:`text-sm break-words whitespace-normal ${E} opacity-70`,title:y.part,children:y.part}),L&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${L.colorClass}`,children:[L.percentage,"% match"]})})]}),e.jsx("td",{className:"px-4 py-3 text-center hidden md:table-cell align-middle w-36",children:e.jsx("div",{className:"flex flex-col items-center space-y-1",children:y.keys.length>=2?e.jsxs("div",{className:"cursor-help",title:`All keys: ${y.keys.join(", ")}`,children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${M} ${E}`,children:y.primaryKey||y.keys[0]||"N/A"}),e.jsxs("span",{className:`text-xs ${E} opacity-60 block mt-1`,title:`All keys: ${y.keys.join(", ")}`,children:["+",y.keys.length-1]})]}):e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${M} ${E}`,children:y.primaryKey||y.keys[0]||"N/A"})})}),e.jsx("td",{className:"px-4 py-3 text-center hidden sm:table-cell align-middle w-24",children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-bold font-mono bg-music-wave/10 text-music-wave",children:y.primaryBpm||y.bpms[0]||"N/A"}),y.bpms.length>1&&e.jsxs("span",{className:`text-xs ${E} opacity-60`,title:`${y.bpms.length} total BPMs`,children:["+",y.bpms.length-1]})]})}),e.jsx("td",{className:"px-4 py-3 text-center hidden lg:table-cell align-middle w-24",children:e.jsx("div",{className:`text-sm font-bold ${E}`,children:y.year})}),e.jsx("td",{className:"px-4 py-3 text-center hidden xl:table-cell align-middle w-28",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx("button",{onClick:T=>{T.stopPropagation(),o?.(y)},className:"group p-2 text-gray-400 hover:text-music-electric hover:bg-music-electric/10 rounded-lg transition-all duration-200 hover:scale-110",title:"Add to project",children:e.jsx(Q,{size:14,className:"group-hover:scale-110 transition-transform"})}),e.jsx("button",{onClick:T=>{T.stopPropagation(),r?.(y)},className:"group p-2 text-gray-400 hover:text-music-electric hover:bg-music-electric/10 rounded-lg transition-all duration-200 hover:scale-110",title:"Edit song",children:e.jsx(Re,{size:14,className:"group-hover:rotate-12 transition-transform"})}),e.jsx("button",{onClick:T=>{T.stopPropagation(),a?.(y.id)},className:"group p-2 text-gray-400 hover:text-music-pulse hover:bg-music-pulse/10 rounded-lg transition-all duration-200 hover:scale-110",title:"Delete song",children:e.jsx(Oe,{size:14,className:"group-hover:rotate-12 transition-transform"})})]})})]},y.id)})})]})}):e.jsx("div",{className:"p-4 space-y-3 md:space-y-2",children:g.map(y=>{const p=h(y.id);return e.jsx(bt,{song:y,compact:!m,coverImageUrl:p??void 0,onEditSong:r,onDeleteSong:a,onAddToProject:o,onSongClick:n,searchScore:y.score},y.id)})}),s.length>l&&e.jsx(ft,{currentPage:c,totalItems:s.length,itemsPerPage:l,onPageChange:d,onItemsPerPageChange:i})]})});function Fs({songsCount:t,projectsCount:s,songs:r,onStartMatching:a}){const o=u.useMemo(()=>{const d=new Set;return r.forEach(l=>{if(l.year&&typeof l.year=="number")d.add(l.year);else if(l.year&&typeof l.year=="string"){const i=parseInt(l.year,10);isNaN(i)||d.add(i)}}),d.size},[r]),n=()=>{if(a)a();else{const d=document.querySelector('[data-hero-scroll-target="search"]');d&&d.scrollIntoView({behavior:"smooth",block:"start"})}},c=()=>{const d=document.querySelector('[data-hero-scroll-target="songs"]');d&&d.scrollIntoView({behavior:"smooth",block:"start"})};return e.jsxs("div",{className:"relative overflow-hidden rounded-2xl mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-600 via-blue-600 to-purple-600 dark:from-indigo-950 dark:via-blue-950 dark:to-purple-950"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500 via-blue-500 to-purple-500 dark:hidden"}),e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-purple-500/20 dark:bg-purple-400/30 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-blue-500/20 dark:bg-blue-400/30 rounded-full blur-3xl"}),e.jsx("div",{className:"hidden md:block absolute top-20 right-20 w-32 h-32 bg-cyan-400/10 dark:bg-cyan-300/20 rounded-full blur-2xl animate-pulse"}),e.jsx("div",{className:"hidden md:block absolute bottom-20 left-20 w-40 h-40 bg-indigo-400/10 dark:bg-indigo-300/20 rounded-full blur-2xl animate-pulse",style:{animationDelay:"1s"}}),e.jsx("div",{className:"md:hidden absolute top-10 right-10 w-24 h-24 bg-cyan-400/10 dark:bg-cyan-300/20 rounded-full blur-2xl animate-pulse"}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-8 lg:py-10",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:gap-6 items-center",children:[e.jsxs("div",{className:"flex-1 space-y-3 animate-fade-in-up",children:[e.jsxs("div",{className:"backdrop-blur-md bg-white/20 dark:bg-white/5 border border-white/40 dark:border-white/10 rounded-2xl p-4 md:p-5 shadow-2xl",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-2 leading-tight",children:"MashHub: Intelligent Music Matching"}),e.jsx("p",{className:"text-base sm:text-lg md:text-xl text-white font-medium mb-2 md:mb-3",children:"Craft The Perfect Mashups"}),e.jsx("p",{className:"text-xs md:text-sm text-white/95 mb-3 md:mb-4 leading-relaxed",children:"Discover seamless musical connections with section-based key detection, BPM compatibility analysis, and advanced harmonic matching. Organize your library with smart filtering and project management tools."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-3 md:mb-4",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-white/30 dark:bg-white/20 backdrop-blur-sm rounded-full border border-white/40 dark:border-white/30",children:[e.jsx(O,{size:14,className:"text-white"}),e.jsx("span",{className:"text-xs font-medium text-white",children:"Harmonic Matching"})]}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-white/30 dark:bg-white/20 backdrop-blur-sm rounded-full border border-white/40 dark:border-white/30",children:[e.jsx(_e,{size:14,className:"text-white"}),e.jsx("span",{className:"text-xs font-medium text-white",children:"Part-Specific Keys"})]}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-white/30 dark:bg-white/20 backdrop-blur-sm rounded-full border border-white/40 dark:border-white/30",children:[e.jsx(ge,{size:14,className:"text-white"}),e.jsx("span",{className:"text-xs font-medium text-white",children:"Smart Filtering"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:n,className:"w-full sm:w-auto min-w-[180px] h-10 inline-flex items-center justify-center gap-2 px-4 py-2 bg-white text-indigo-900 font-semibold rounded-lg hover:bg-indigo-50 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 text-sm","aria-label":"Start matching songs",children:[e.jsx(er,{size:16}),"Start Matching",e.jsx(tr,{size:14})]}),e.jsxs("button",{onClick:c,className:"w-full sm:w-auto min-w-[180px] h-10 inline-flex items-center justify-center gap-2 px-4 py-2 bg-white/25 dark:bg-white/10 backdrop-blur-sm text-white font-semibold rounded-lg border border-white/40 dark:border-white/30 hover:bg-white/35 dark:hover:bg-white/20 transition-all duration-200 text-sm","aria-label":"Explore music library",children:[e.jsx(dt,{size:16}),"Explore Library"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-3",children:[e.jsxs("div",{className:"backdrop-blur-md bg-white/25 dark:bg-white/10 border border-white/40 dark:border-white/20 rounded-xl p-2 md:p-3 text-center",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-white mb-1",children:t.toLocaleString()}),e.jsx("div",{className:"text-xs md:text-sm text-white/90",children:"Total Songs"})]}),e.jsxs("div",{className:"backdrop-blur-md bg-white/25 dark:bg-white/10 border border-white/40 dark:border-white/20 rounded-xl p-2 md:p-3 text-center",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-white mb-1",children:s.toLocaleString()}),e.jsx("div",{className:"text-xs md:text-sm text-white/90",children:"Projects"})]}),e.jsxs("div",{className:"col-span-2 md:col-span-1 backdrop-blur-md bg-white/25 dark:bg-white/10 border border-white/40 dark:border-white/20 rounded-xl p-2 md:p-3 text-center",children:[e.jsx("div",{className:"text-xl md:text-2xl font-bold text-white mb-1",children:o}),e.jsx("div",{className:"text-xs md:text-sm text-white/90",children:"Supported Years"})]})]})]}),e.jsx("div",{className:"hidden md:flex flex-shrink-0 w-full md:w-64 lg:w-80 items-center justify-center",children:e.jsx("div",{className:"relative w-full aspect-square",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative w-48 h-48",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-white/30 dark:border-white/10 animate-spin-slow"}),e.jsx("div",{className:"absolute inset-3 rounded-full border-4 border-white/25 dark:border-indigo-400/20 animate-spin-slow-reverse"}),e.jsx("div",{className:"absolute inset-6 rounded-full border-4 border-white/20 dark:border-purple-400/20 animate-spin-slow"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-20 h-20 bg-white/30 dark:bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center border border-white/40 dark:border-white/30",children:e.jsx(O,{size:40,className:"text-white"})})})]})})})})]})})})]})}const Ls=[{name:"YouTube",url:"https://www.youtube.com/c/CosmicMashups",icon:or,ariaLabel:"Visit CosmicMashups on YouTube (opens in new tab)"},{name:"Twitter",url:"https://twitter.com/CosmicMashups",icon:ir,ariaLabel:"Visit CosmicMashups on Twitter (opens in new tab)"},{name:"TikTok",url:"https://www.tiktok.com/@cosmic_mashups",icon:cr,ariaLabel:"Visit cosmic_mashups on TikTok (opens in new tab)"},{name:"MyAnimeList",url:"https://myanimelist.net/profile/CosmicMashups",icon:dt,ariaLabel:"Visit CosmicMashups on MyAnimeList (opens in new tab)"},{name:"Bandcamp",url:"https://cosmicmashups.bandcamp.com/",icon:O,ariaLabel:"Visit CosmicMashups on Bandcamp (opens in new tab)"}],Ds=[{name:"Features",href:"#features"},{name:"Advanced Matching",href:"#matching"},{name:"Projects",href:"#projects"},{name:"Filtering",href:"#filtering"},{name:"Documentation",href:"#docs"}],Rs=[{name:"GitHub",href:"#",icon:rr},{name:"API Credits",href:"#api-credits",icon:sr},{name:"Privacy Policy",href:"#privacy",icon:ar},{name:"Terms of Service",href:"#terms",icon:nr}],Os=u.memo(function(){const s=new Date().getFullYear();return e.jsxs("footer",{className:"relative mt-16 border-t border-theme-border-default bg-theme-background-primary",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 via-blue-500/5 to-purple-500/5 dark:from-indigo-500/10 dark:via-blue-500/10 dark:to-purple-500/10 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-12 mb-8",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("h3",{className:"text-xl font-bold text-theme-text-primary mb-3",children:"MashHub"}),e.jsx("p",{className:"text-sm text-theme-text-secondary leading-relaxed",children:"Intelligent music matching for DJs, producers, and mashup creators."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-theme-text-primary mb-4 uppercase tracking-wider",children:"Product"}),e.jsx("ul",{className:"space-y-3",children:Ds.map(r=>e.jsx("li",{children:e.jsx("a",{href:r.href,className:"text-sm text-theme-text-secondary hover:text-theme-accent-primary transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-theme-accent-primary focus:ring-offset-2 focus:ring-offset-theme-background-primary rounded","aria-label":r.name,children:r.name})},r.name))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-theme-text-primary mb-4 uppercase tracking-wider",children:"Resources"}),e.jsx("ul",{className:"space-y-3",children:Rs.map(r=>{const a=r.icon;return e.jsx("li",{children:e.jsxs("a",{href:r.href,className:"flex items-center gap-2 text-sm text-theme-text-secondary hover:text-theme-accent-primary transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-theme-accent-primary focus:ring-offset-2 focus:ring-offset-theme-background-primary rounded","aria-label":r.name==="API Credits"?"View API Credits - Spotify API and Jikan API":r.name,children:[e.jsx(a,{size:16,className:"flex-shrink-0"}),e.jsx("span",{children:r.name}),r.name==="API Credits"&&e.jsx("span",{className:"text-xs text-theme-text-muted ml-1",children:"(Spotify, Jikan)"})]})},r.name)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-theme-text-primary mb-4 uppercase tracking-wider",children:"Connect"}),e.jsx("ul",{className:"space-y-3",children:Ls.map(r=>{const a=r.icon;return e.jsx("li",{children:e.jsxs("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-theme-text-secondary hover:text-theme-accent-primary transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-theme-accent-primary focus:ring-offset-2 focus:ring-offset-theme-background-primary rounded group","aria-label":r.ariaLabel,children:[e.jsx(a,{size:16,className:"flex-shrink-0"}),e.jsx("span",{children:r.name}),e.jsx(lr,{size:12,className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200","aria-hidden":"true"})]})},r.name)})})]})]}),e.jsx("div",{className:"border-t border-theme-border-default pt-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("p",{className:"text-sm text-theme-text-muted",children:["© ",s," MashHub. All rights reserved."]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-theme-text-muted",children:[e.jsx("span",{children:"Powered by"}),e.jsx("a",{href:"https://developer.spotify.com/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-theme-accent-primary transition-colors focus:outline-none focus:ring-2 focus:ring-theme-accent-primary focus:ring-offset-2 focus:ring-offset-theme-background-primary rounded","aria-label":"Spotify API (opens in new tab)",children:"Spotify API"}),e.jsx("span",{children:"and"}),e.jsx("a",{href:"https://jikan.moe/",target:"_blank",rel:"noopener noreferrer",className:"hover:text-theme-accent-primary transition-colors focus:outline-none focus:ring-2 focus:ring-theme-accent-primary focus:ring-offset-2 focus:ring-offset-theme-background-primary rounded","aria-label":"Jikan API (opens in new tab)",children:"Jikan API"})]})]})})]})]})});function _s({open:t,onClose:s,onProjectsClick:r,onAddSongClick:a,onUtilitiesClick:o,onFiltersClick:n}){const c=d=>{d(),s()};return e.jsx(xr,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(Xe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 z-50 bg-black/50 lg:hidden"}),e.jsx(Xe.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed left-0 top-0 bottom-0 z-50 w-[280px] bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 lg:hidden overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("button",{onClick:s,className:"absolute top-4 right-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors","aria-label":"Close menu",children:e.jsx(Y,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center space-x-2 mb-8",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-music-electric to-music-cosmic rounded-lg flex items-center justify-center",children:e.jsx(O,{className:"h-6 w-6 text-white"})}),e.jsx("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"MashHub"})]}),e.jsxs("nav",{className:"space-y-2 mb-8",children:[e.jsxs("button",{onClick:()=>c(r),className:"w-full flex items-center px-4 py-3 text-left text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[e.jsx(mt,{className:"h-5 w-5 mr-3"}),"Projects"]}),e.jsxs("button",{onClick:()=>c(n),className:"w-full flex items-center px-4 py-3 text-left text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[e.jsx(ge,{className:"h-5 w-5 mr-3"}),"Filters"]}),e.jsxs("button",{onClick:()=>c(o),className:"w-full flex items-center px-4 py-3 text-left text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[e.jsx(dr,{className:"h-5 w-5 mr-3"}),"Utilities"]})]}),e.jsx("div",{className:"space-y-2 border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("button",{onClick:()=>c(a),className:"w-full flex items-center justify-center px-4 py-3 bg-music-electric text-white rounded-lg hover:bg-music-electric/90 transition-colors font-medium",children:[e.jsx(Q,{className:"h-5 w-5 mr-2"}),"Add Song"]})})]})})]})})}const Bs=u.lazy(()=>B(()=>import("./SongModal-DGXWUw_A.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(t=>({default:t.SongModal}))),$s=u.lazy(()=>B(()=>import("./AdvancedFiltersDialog-UelbPbM4.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8])).then(t=>({default:t.AdvancedFiltersDialog}))),Ks=u.lazy(()=>B(()=>import("./ImportExportModal-BS4mMzUA.js"),__vite__mapDeps([10,1,2,6,4,5,3,7,8])).then(t=>({default:t.ImportExportModal}))),zs=u.lazy(()=>B(()=>import("./EnhancedExportModal-B5qYdMDT.js"),__vite__mapDeps([11,1,2,4,5,3,6,7,8])).then(t=>({default:t.EnhancedExportModal}))),Us=u.lazy(()=>B(()=>import("./UtilityDialog-CCujGi5B.js"),__vite__mapDeps([12,1,2,4,5,3,6,7,8])).then(t=>({default:t.UtilityDialog}))),Vs=u.lazy(()=>B(()=>import("./EnhancedProjectManager-DptBPNVN.js"),__vite__mapDeps([13,1,2,7,3,6,8,5])).then(t=>({default:t.EnhancedProjectManager}))),Hs=u.lazy(()=>B(()=>import("./AddToProjectModal-BRrvnCNV.js"),__vite__mapDeps([14,1,2,4,5,3,6,7,8])).then(t=>({default:t.AddToProjectModal}))),qs=u.lazy(()=>B(()=>import("./SongDetailsModal-Lxgrxjnc.js"),__vite__mapDeps([15,1,2,3,4,5,6,7,8])).then(t=>({default:t.SongDetailsModal})));function Ys(){console.log("App component rendering...");const{songs:t,loading:s,error:r,addSong:a,addMultipleSongs:o,updateSong:n,deleteSong:c,searchSongs:d,forceReloadFromCsv:l}=os(),{projects:i,addProject:m,deleteProject:f}=is();console.log("App state:",{songs:t.length,loading:s,error:r,projects:i.length});const[x,g]=u.useState(!1),[h,y]=u.useState(null),[p,w]=u.useState(!1),[v,N]=u.useState(!1),[M,E]=u.useState(!1),[_,U]=u.useState(!1),[L,T]=u.useState(""),[k,A]=u.useState([]),[b,C]=u.useState({}),[P,J]=u.useState(Le()),[V,ue]=u.useState([]),[he,pe]=u.useState(!1),[Ke,ze]=u.useState(!1),[Ue,St]=u.useState(!1),[Nt,Ve]=u.useState(!1),[Ct,It]=u.useState(null),[ee,xe]=u.useState(!1),[Mt,Et]=u.useState(null),[At,ye]=u.useState(!1),te=G.useRef(null),He=async S=>{C(S);const I=await Ce.findMatches(t,S);A(I)},Tt=S=>{J(S);const I=Fe(S);He(I)},Pt=u.useCallback(S=>{J(S)},[]),Ft=u.useCallback(S=>{const I=Fe(S);C(I),Ce.findMatches(t,I).then(D=>{A(D)})},[t]),qe=()=>{C({}),J(Le()),A(t),T(""),pe(!1),ue([])},Lt=S=>{console.log("handleSearchResults called with:",S.length,"results");const I=S.map(D=>({...D.item,score:D.score,matches:D.matches}));console.log("Converted to song results:",I.length),ue(I),pe(!0),console.log("Set isSearching to true")},Dt=()=>{ue([]),pe(!1),A(t)},Rt=async S=>{try{const I=await a(S);return g(!1),I}catch(I){throw console.error("Failed to add song:",I),I}},Ot=async S=>{try{return await n(S),g(!1),y(null),S}catch(I){throw console.error("Failed to update song:",I),I}},fe=async S=>{try{await c(S)}catch(I){console.error("Failed to delete song:",I)}},re=S=>{ee?(te.current=S,xe(!1)):(y(S),g(!0))};u.useEffect(()=>{if(te.current&&!ee){const S=te.current;te.current=null;const I=setTimeout(()=>{y(S),g(!0)},0);return()=>clearTimeout(I)}},[ee]);const Ye=()=>{y(null),g(!0)},_t=()=>{g(!1),y(null)},Bt=async S=>{try{await o(S),E(!1)}catch(I){throw console.error("Failed to import songs:",I),I}},Ge=async S=>{try{await m(S)}catch(I){console.error("Failed to create project:",I)}},We=async(S,I,D)=>{try{await R.addSongToProject(S,I,D),await ae()}catch(X){throw console.error("Failed to add song to project:",X),X}},be=S=>{It(S),Ve(!0)},we=S=>{Et(S),xe(!0)},$t=async(S,I)=>{try{await R.removeSongFromProject(S,I),await ae()}catch(D){throw console.error("Failed to remove song from project:",D),D}},Kt=async(S,I,D)=>{try{await R.reorderSongsInSection(S,I,D),await ae()}catch(X){throw console.error("Failed to reorder songs:",X),X}},[je,zt]=u.useState([]);G.useEffect(()=>{const S=setTimeout(()=>{s&&(console.log("Loading timeout reached, setting loadingTimeout to true"),St(!0))},1e4);return()=>clearTimeout(S)},[s]);const se=G.useCallback(async()=>{const S=await Promise.all(i.map(async I=>{try{return await R.getProjectWithSections(I.id)}catch{return{...I,sections:{}}}}));zt(S)},[i]),ae=G.useCallback(async()=>{i.length>0&&await se()},[i.length,se]);return G.useEffect(()=>{i.length>0&&se()},[i.length,se]),G.useEffect(()=>{Object.keys(b).length>0?Ce.findMatches(t,b).then(S=>{A(S)}):L.trim()?d(L).then(S=>{A(S)}):A(t)},[t,L,b,d]),s&&!Ue?(console.log("App is in loading state"),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center",children:e.jsxs("div",{className:"text-center animate-fade-in-up",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-primary-200 dark:border-primary-800 mx-auto mb-6"}),e.jsx("div",{className:"animate-pulse rounded-full h-16 w-16 border-4 border-primary-600 absolute top-0 left-1/2 transform -translate-x-1/2"})]}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Loading Mashup Manager"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Preparing your music library..."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Loading songs and projects..."})]})})):Ue?(console.log("App loading timeout reached, showing fallback"),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center",children:e.jsx("div",{className:"text-center animate-fade-in-up max-w-md mx-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-hard p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("svg",{className:"h-8 w-8 text-yellow-600 dark:text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Loading Taking Too Long"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"The application is taking longer than expected to load. This might be due to a large dataset or network issues."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded w-full",children:"Reload Page"})]})})})):r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center",children:e.jsx("div",{className:"text-center animate-fade-in-up max-w-md mx-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-hard p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-accent-red-100 dark:bg-accent-red-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(mr,{className:"h-8 w-8 text-accent-red-600 dark:text-accent-red-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Oops! Something went wrong"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Error loading songs: ",r]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn-primary w-full",children:"Try Again"})]})})}):(console.log("App render: songs.length =",t.length,"loading =",s,"error =",r),console.log("App render: filteredSongs.length =",k.length),console.log("App render: isSearching =",he),e.jsx(Ss,{songs:t,children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 transition-all duration-300",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-music-electric to-music-cosmic rounded-lg flex items-center justify-center",children:e.jsx(O,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"MashHub"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Music Library & Database"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"hidden lg:flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>ye(!0),className:"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Utilities","aria-label":"Open utilities menu",children:e.jsx(De,{size:20})}),e.jsxs("button",{onClick:()=>N(!0),className:"px-3 py-2.5 min-h-[44px] text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Manage Projects",children:[e.jsx(mt,{size:16,className:"inline mr-1"}),"Projects"]}),e.jsxs("button",{onClick:Ye,className:"px-4 py-2.5 min-h-[44px] bg-music-electric text-white text-sm font-medium rounded-lg hover:bg-music-electric/90 transition-colors",title:"Add New Song",children:[e.jsx(Q,{size:16,className:"inline mr-1"}),"Add Song"]})]}),e.jsx("button",{onClick:()=>ze(!Ke),className:"lg:hidden p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Open menu",children:e.jsx(gr,{size:20})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[e.jsx("div",{"data-hero-scroll-target":"hero",children:e.jsx(Fs,{songsCount:t.length,projectsCount:i.length,songs:t,onStartMatching:()=>w(!0)})}),e.jsxs("div",{className:"space-y-6","data-hero-scroll-target":"search",children:[e.jsx("div",{className:"animate-fade-in-up",children:e.jsx(As,{songs:t,onSearch:Lt,onClear:Dt})}),e.jsx("div",{className:"animate-fade-in-up",children:e.jsx(ks,{filterState:P,onFilterChange:Tt,onAdvancedFiltersClick:()=>w(!0),onApplyFilters:He})}),Object.keys(b).length>0&&e.jsx("div",{className:"animate-slide-down",children:e.jsxs("div",{className:"card p-4 bg-gradient-to-r from-primary-50 to-accent-purple-50 dark:from-primary-900/20 dark:to-accent-purple-900/20 border-primary-200 dark:border-primary-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-primary-900 dark:text-primary-100 flex items-center",children:[e.jsx(ge,{size:16,className:"mr-2"}),"Active Filters"]}),e.jsx("button",{onClick:qe,className:"text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-200 text-xs font-medium",children:"Clear All"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[b.targetBpm&&e.jsxs("span",{className:"filter-tag",children:["BPM: ",b.targetBpm," ±",b.bpmTolerance]}),b.bpmRange&&e.jsxs("span",{className:"filter-tag",children:["BPM Range: ",b.bpmRange[0],"-",b.bpmRange[1]]}),b.selectedKeys&&b.selectedKeys.length>0&&e.jsxs("span",{className:"filter-tag",children:["Key: ",b.selectedKeys.length===1?b.selectedKeys[0]:`${b.selectedKeys.length} keys`]}),b.targetKey&&!b.selectedKeys&&e.jsxs("span",{className:"filter-tag",children:["Key: ",b.targetKey," ±",b.keyTolerance]}),b.type&&e.jsxs("span",{className:"filter-tag",children:["Type: ",b.type]}),b.origin&&e.jsxs("span",{className:"filter-tag",children:["Origin: ",b.origin]}),b.season&&e.jsxs("span",{className:"filter-tag",children:["Season: ",b.season]}),b.artist&&e.jsxs("span",{className:"filter-tag",children:["Artist: ",b.artist]}),b.yearRange&&e.jsxs("span",{className:"filter-tag",children:["Year: ",b.yearRange[0],"-",b.yearRange[1]]}),b.searchText&&e.jsxs("span",{className:"filter-tag",children:["Search: ",b.searchText]}),b.partSpecificKey&&b.partSpecificKey.section&&b.partSpecificKey.key&&e.jsxs("span",{className:"filter-tag",children:[b.partSpecificKey.section,": ",b.partSpecificKey.key]}),b.partSpecificFilters&&b.partSpecificFilters.length>0&&e.jsxs("span",{className:"filter-tag",children:["Part Filters: ",b.partSpecificFilters.length]})]})]})}),(Object.keys(b).length>0||L.trim()||he)&&e.jsx("div",{className:"animate-slide-down",children:e.jsxs("button",{onClick:qe,className:"btn-secondary",children:[e.jsx(Y,{size:16,className:"mr-2"}),"Clear All Filters"]})})]}),he?e.jsx("div",{className:"animate-fade-in-up",children:e.jsx(Ps,{results:V,onEditSong:re,onDeleteSong:fe,onAddToProject:be,onSongClick:we})}):e.jsx("div",{className:"space-y-6","data-hero-scroll-target":"songs",children:e.jsx("div",{className:"animate-fade-in-up",style:{animationDelay:"0.5s"},children:e.jsx(Jr,{songs:k,onEditSong:re,onDeleteSong:fe,onAddToProject:be,onSongClick:we})})})]}),e.jsx(u.Suspense,{fallback:null,children:e.jsx(Bs,{isOpen:x,onClose:_t,onSave:Rt,onUpdate:Ot,song:h,title:h?"Edit Song":"Add New Song"})}),e.jsx(u.Suspense,{fallback:null,children:e.jsx($s,{isOpen:p,onClose:()=>w(!1),songs:t,filterState:P,onFilterStateChange:Pt,onApplyFilters:Ft,onSongClick:we})}),e.jsx(u.Suspense,{fallback:null,children:e.jsx(Vs,{isOpen:v,onClose:()=>N(!1),projects:je,allSongs:t,onCreateProject:Ge,onDeleteProject:f,onAddSongToProject:We,onRemoveSongFromProject:$t,onReorderSongs:Kt,onEditSong:re,onRefresh:ae})}),e.jsx(u.Suspense,{fallback:null,children:e.jsx(Ks,{isOpen:M,onClose:()=>E(!1),onImport:Bt,songs:t})}),e.jsx(u.Suspense,{fallback:null,children:e.jsx(zs,{isOpen:_,onClose:()=>U(!1),songs:t,projects:je})}),e.jsx(u.Suspense,{fallback:null,children:e.jsx(Hs,{isOpen:Nt,onClose:()=>Ve(!1),song:Ct,projects:je,onCreateProject:Ge,onAddSongToProject:We})}),e.jsx(u.Suspense,{fallback:null,children:e.jsx(qs,{isOpen:ee,onClose:()=>xe(!1),song:Mt,onEditSong:re,onAddToProject:be,onDeleteSong:fe})}),e.jsx(u.Suspense,{fallback:null,children:e.jsx(Us,{isOpen:At,onClose:()=>ye(!1),songsCount:t.length,projectsCount:i.length,onImport:()=>E(!0),onExport:()=>U(!0),onReloadCsv:l})}),e.jsx(_s,{open:Ke,onClose:()=>ze(!1),onProjectsClick:()=>N(!0),onAddSongClick:Ye,onUtilitiesClick:()=>ye(!0),onFiltersClick:()=>w(!0)}),e.jsx(Os,{})]})}))}class Gs extends u.Component{constructor(s){super(s),this.state={hasError:!1},this.reset=this.reset.bind(this)}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error(`[ErrorBoundary${this.props.name?` (${this.props.name})`:""}] caught an error:`,s,r)}reset(){this.setState({hasError:!1,error:void 0})}render(){if(this.state.hasError){const s=this.state.error??new Error("Unknown error");if(this.props.fallback)return this.props.fallback(s,this.reset);const r=this.props.name?`${this.props.name} encountered a problem`:"Something went wrong";return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center",children:e.jsx("div",{className:"text-center animate-fade-in-up max-w-md mx-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-hard p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("svg",{className:"h-8 w-8 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",role:"alert",children:r}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:s.message||"An unexpected error occurred"}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx("button",{onClick:this.reset,className:"flex-1 bg-blue-100 hover:bg-blue-200 text-blue-700 dark:bg-blue-900/30 dark:hover:bg-blue-900/50 dark:text-blue-300 font-medium py-2 px-4 rounded",children:"Try again"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",children:"Reload Page"})]})]})})})}return this.props.children}}setTimeout(()=>{z.cleanOrphanedSections().then(t=>{t>0&&console.info(`[DB cleanup] Removed ${t} orphaned section(s).`)}).catch(t=>{console.warn("[DB cleanup] cleanOrphanedSections failed:",t)})},3e3);Ut.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(Gs,{children:e.jsx(Ys,{})})}));export{Be as A,xs as B,Ae as E,fs as K,Ce as M,B as _,z as a,ss as b,Z as c,ra as d,aa as e,$e as h,hs as i,as as p,Gr as r,at as s,sa as u};
