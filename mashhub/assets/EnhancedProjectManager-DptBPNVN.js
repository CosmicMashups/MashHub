import{j as e,r as x}from"./vendor-react-BqYHFrkR.js";import{u as Z,C as _,b as ee,S as se,v as te,D as re,c as ae}from"./vendor-dnd-dosGBBqk.js";import{Q as ie,M as w,P as le,T as q,c as A,f as ne,g as ce,X as M,q as T,r as oe,S as de}from"./vendor-lucide-Bb8j8FOq.js";import{u as U}from"./index-DrdfCScI.js";import"./vendor-dexie-CKmTJlxL.js";import"./vendor-exceljs-Et7_ggJF.js";import"./vendor-fuse-Dw8P0qyA.js";import"./vendor-motion-DuQQDTmZ.js";function Q({song:i,onEdit:n,onDelete:c,showActions:d=!0,disableDrag:h=!1}){const{attributes:j,listeners:o,setNodeRef:p,transform:y,transition:g,isDragging:f}=Z({id:i.id,disabled:h}),l={transform:_.Transform.toString(y),transition:g};return e.jsx("div",{ref:p,style:l,className:`bg-white p-3 rounded-lg border transition-all ${f?"shadow-lg opacity-50":"hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[!h&&e.jsx("div",{...j,...o,className:"cursor-grab hover:cursor-grabbing text-gray-400 hover:text-gray-600",children:e.jsx(ie,{size:16})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{size:16,className:"text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:i.title}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:i.artist})]})]}),e.jsxs("div",{className:"mt-1 flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["BPM: ",i.primaryBpm||i.bpms[0]||"N/A"]}),e.jsxs("span",{children:["Key: ",i.primaryKey||i.keys[0]||"N/A"]})]})]}),d&&e.jsxs("div",{className:"flex items-center space-x-1",children:[n&&e.jsx("button",{onClick:()=>n(i),className:"text-gray-400 hover:text-primary-600 p-1",title:"Edit song",children:e.jsx(le,{size:14})}),c&&e.jsx("button",{onClick:()=>c(i.id),className:"text-gray-400 hover:text-red-600 p-1",title:"Remove from project",children:e.jsx(q,{size:14})})]})]})})}function me({sectionName:i,songs:n,projectId:c,onAddSong:d,onEditSong:h,onRemoveSong:j,onReorderSongs:o}){const{setNodeRef:p,isOver:y}=ee({id:`section-${c}-${i}`}),g=U(),f=t=>{if(t===0||!o)return;const r=[...n];[r[t-1],r[t]]=[r[t],r[t-1]],o(c,i,r.map(m=>m.id))},l=t=>{if(t===n.length-1||!o)return;const r=[...n];[r[t],r[t+1]]=[r[t+1],r[t]],o(c,i,r.map(m=>m.id))};return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:i}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[n.length," songs"]}),d&&e.jsx("button",{onClick:()=>d(c,i),className:"text-primary-600 hover:text-primary-800 p-1",title:"Add song to section",children:e.jsx(A,{size:16})})]})]}),e.jsx("div",{ref:p,className:`min-h-[100px] space-y-2 transition-colors ${y?"bg-primary-50 border-2 border-dashed border-primary-300":""}`,children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(w,{size:32,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No songs in this section"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Drag songs here or click + to add"})]}):e.jsx(e.Fragment,{children:g?e.jsx("div",{className:"space-y-2",children:n.map((t,r)=>e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(Q,{song:t,onEdit:h,onDelete:m=>j?.(c,m),disableDrag:!0})}),e.jsxs("div",{className:"flex flex-col ml-2 gap-1",children:[e.jsx("button",{onClick:()=>f(r),disabled:r===0,className:"p-1 min-w-[44px] min-h-[44px] flex items-center justify-center text-gray-600 hover:text-gray-900 disabled:opacity-30 disabled:cursor-not-allowed rounded-md transition-colors","aria-label":"Move up",children:e.jsx(ne,{size:18})}),e.jsx("button",{onClick:()=>l(r),disabled:r===n.length-1,className:"p-1 min-w-[44px] min-h-[44px] flex items-center justify-center text-gray-600 hover:text-gray-900 disabled:opacity-30 disabled:cursor-not-allowed rounded-md transition-colors","aria-label":"Move down",children:e.jsx(ce,{size:18})})]})]},t.id))}):e.jsx(se,{items:n.map(t=>t.id),strategy:te,children:n.map(t=>e.jsx(Q,{song:t,onEdit:h,onDelete:r=>j?.(c,r)},t.id))})})})]})}function be({isOpen:i,onClose:n,projects:c,allSongs:d,onCreateProject:h,onDeleteProject:j,onAddSongToProject:o,onRemoveSongFromProject:p,onReorderSongs:y,onEditSong:g,onRefresh:f}){const[l,t]=x.useState(null),[r,m]=x.useState(""),[V,S]=x.useState(!1),[C,D]=x.useState(null),[E,k]=x.useState(null),[P,L]=x.useState(""),[b,F]=x.useState(""),[G,N]=x.useState(!1),v=U();if(!i)return null;const O=async()=>{if(r.trim())try{await h(r.trim()),m("")}catch(s){console.error("Failed to create project:",s),alert("Failed to create project. Please try again.")}},I=async s=>{if(window.confirm("Are you sure you want to delete this project? All songs will be removed."))try{await j(s),l?.id===s&&t(null)}catch(a){console.error("Failed to delete project:",a),alert("Failed to delete project. Please try again.")}},R=(s,a)=>{D({projectId:s,sectionName:a}),S(!0)},W=async s=>{if(C)try{await o(C.projectId,s.id,C.sectionName),S(!1),D(null),L(""),f?.()}catch(a){console.error("Failed to add song to project:",a),alert("Failed to add song to project. Please try again.")}},B=()=>{if(!P.trim())return d;const s=P.toLowerCase();return d.filter(a=>a.title.toLowerCase().includes(s)||a.artist.toLowerCase().includes(s)||a.type.toLowerCase().includes(s)||a.origin.toLowerCase().includes(s)||a.season.toLowerCase().includes(s)||a.keys.some(u=>u.toLowerCase().includes(s))||a.bpms.some(u=>u.toString().includes(s)))},$=()=>{if(b.trim()&&l){const s={...l,sections:{...l.sections,[b.trim()]:[]}};t(s),F(""),N(!1)}},X=()=>{if(!l)return K;const s=Object.keys(l.sections);return[...new Set([...K,...s])]},H=s=>{const{active:a}=s,u=d.find(z=>z.id===a.id);k(u||null)},J=()=>{},Y=s=>{const{over:a}=s;if(!a){k(null);return}if(a.id.toString().startsWith("section-")){const[u,z]=a.id.toString().replace("section-","").split("-");E&&o(u,E.id,z)}k(null)},K=["Intro","Main","Outro","Bridge","Chorus","Verse","Break","Drop","Build","Ending"];return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 md:p-6 border-b",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-gray-900",children:"Project Manager"}),e.jsx("button",{onClick:n,className:"p-2 min-w-[44px] min-h-[44px] flex items-center justify-center text-gray-400 hover:text-gray-600 rounded-md transition-colors","aria-label":"Close",children:e.jsx(M,{size:20,className:"md:w-6 md:h-6"})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row h-[600px] md:h-[600px]",children:[e.jsxs("div",{className:"w-full md:w-1/3 border-b md:border-b-0 md:border-r border-gray-200 p-4 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base md:text-lg font-medium text-gray-900",children:"Projects"}),e.jsxs("button",{onClick:O,className:`btn-primary text-sm ${v?"p-2 min-w-[44px] min-h-[44px]":""}`,title:v?"New Project":void 0,children:[e.jsx(A,{size:16,className:v?"":"mr-1"}),!v&&"New"]})]}),e.jsx("div",{className:"space-y-2 mb-4",children:e.jsx("input",{type:"text",value:r,onChange:s=>m(s.target.value),onKeyPress:s=>s.key==="Enter"&&O(),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Project name"})}),e.jsx("div",{className:"space-y-2",children:c.map(s=>e.jsxs("div",{className:`p-3 rounded-lg cursor-pointer transition-colors ${l?.id===s.id?"bg-primary-100 border-2 border-primary-500":"bg-gray-50 hover:bg-gray-100 border-2 border-transparent"}`,onClick:()=>t(s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{size:16,className:"text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.name})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),I(s.id)},className:"text-red-600 hover:text-red-800",children:e.jsx(q,{size:14})})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[Object.values(s.sections).flat().length," songs"]})]},s.id))})]}),e.jsx("div",{className:"flex-1 p-4 md:p-4 overflow-y-auto",children:l?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:l.name}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("button",{onClick:()=>N(!0),className:"btn-primary text-sm min-h-[44px]",children:[e.jsx(A,{size:16,className:"mr-1"}),"Add Section"]}),e.jsxs("button",{className:"btn-secondary text-sm min-h-[44px]",children:[e.jsx(oe,{size:16,className:"mr-1"}),"Settings"]})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Created: ",l.createdAt.toLocaleDateString()]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Total Songs: ",Object.values(l.sections).flat().length]})]}),e.jsx(re,{collisionDetection:ae,onDragStart:H,onDragOver:J,onDragEnd:Y,children:e.jsx("div",{className:"space-y-4",children:X().map(s=>e.jsx(me,{sectionName:s,songs:l.sections[s]||[],projectId:l.id,onAddSong:R,onEditSong:g,onRemoveSong:p,onReorderSongs:y},s))})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(T,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Select a project to view details"})]})})]}),e.jsx("div",{className:"flex justify-end p-4 md:p-6 border-t bg-gray-50",children:e.jsx("button",{onClick:n,className:"btn-secondary w-full md:w-auto min-h-[44px]",children:"Close"})})]}),V&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-60",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Song to Project"}),e.jsx("button",{onClick:()=>S(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(M,{size:24})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(de,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:P,onChange:s=>L(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Search songs by title, artist, type, origin, season, key, or BPM..."})]})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:B().length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(w,{size:32,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No songs found matching your search"})]}):B().map(s=>e.jsx("div",{onClick:()=>W(s),className:"p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{size:16,className:"text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500",children:s.artist})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.primaryBpm||s.bpms[0]," BPM, ",s.primaryKey||s.keys[0]]})]})},s.id))})]})]})}),G&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-60",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Custom Section"}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(M,{size:24})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section Name"}),e.jsx("input",{type:"text",value:b,onChange:s=>F(s.target.value),onKeyPress:s=>s.key==="Enter"&&$(),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Enter section name (e.g., 'Pre-Chorus', 'Interlude')"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>N(!1),className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:$,className:"btn-primary",disabled:!b.trim(),children:"Add Section"})]})]})]})})]})}export{be as EnhancedProjectManager};
