import{r,j as e}from"./vendor-react-BqYHFrkR.js";import{u as F}from"./index-DrdfCScI.js";import{S as z,a as M}from"./Sheet-DSnqxl5f.js";import{X as E,M as A,S as B,q as y,c as q}from"./vendor-lucide-Bb8j8FOq.js";import"./vendor-dexie-CKmTJlxL.js";import"./vendor-exceljs-Et7_ggJF.js";import"./vendor-dnd-dosGBBqk.js";import"./vendor-fuse-Dw8P0qyA.js";import"./vendor-motion-DuQQDTmZ.js";const D=["Intro","Main","Outro","Bridge","Chorus","Verse","Break","Drop","Build","Ending"];function X({isOpen:m,onClose:n,song:a,projects:x,onCreateProject:N,onAddSongToProject:v}){const[t,u]=r.useState(null),[l,h]=r.useState(""),[o,i]=r.useState(""),[w,c]=r.useState(!1),[d,j]=r.useState(""),S=F();if(!m||!a)return null;const C=async()=>{if(t&&l)try{await v(t.id,a.id,l),n(),b()}catch(s){console.error("Failed to add song to project:",s),alert("Failed to add song to project. Please try again.")}},p=async()=>{if(o.trim())try{await N(o.trim()),i(""),c(!1)}catch(s){console.error("Failed to create project:",s),alert("Failed to create project. Please try again.")}},f=()=>{if(!d.trim())return x;const s=d.toLowerCase();return x.filter(k=>k.name.toLowerCase().includes(s))},b=()=>{u(null),h(""),i(""),c(!1),j("")},P=()=>{b(),n()},g=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-4 md:p-6 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Song to Project"}),e.jsx("button",{onClick:P,className:"p-2 min-w-[44px] min-h-[44px] flex items-center justify-center text-gray-400 hover:text-gray-600 rounded-md transition-colors","aria-label":"Close",children:e.jsx(E,{size:20,className:"md:w-6 md:h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{size:20,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.title}),e.jsx("p",{className:"text-sm text-gray-500",children:a.artist})]})]})}),w?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Name"}),e.jsx("input",{type:"text",value:o,onChange:s=>i(s.target.value),onKeyPress:s=>s.key==="Enter"&&p(),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 min-h-[44px]",placeholder:"Enter project name"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-2",children:[e.jsx("button",{onClick:()=>c(!1),className:"btn-secondary w-full sm:w-auto min-h-[44px]",children:"Back"}),e.jsx("button",{onClick:p,disabled:!o.trim(),className:"btn-primary w-full sm:w-auto min-h-[44px]",children:"Create Project"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Project"}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(B,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:d,onChange:s=>j(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Search projects..."})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-gray-200 rounded-md",children:f().length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(y,{size:32,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No projects found"})]}):f().map(s=>e.jsxs("div",{onClick:()=>u(s),className:`p-3 cursor-pointer hover:bg-gray-50 transition-colors ${t?.id===s.id?"bg-primary-50 border-l-4 border-primary-500":""}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{size:16,className:"text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.name})]}),e.jsxs("p",{className:"text-sm text-gray-500 ml-6",children:[Object.values(s.sections).flat().length," songs"]})]},s.id))})]}),t&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Section"}),e.jsxs("select",{value:l,onChange:s=>h(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Choose a section..."}),D.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-2",children:[e.jsxs("button",{onClick:()=>c(!0),className:"btn-secondary w-full sm:w-auto min-h-[44px]",children:[e.jsx(q,{size:16,className:"mr-1"}),"Create New Project"]}),e.jsx("button",{onClick:C,disabled:!t||!l,className:"btn-primary w-full sm:w-auto min-h-[44px]",children:"Add to Project"})]})]})]})]});return S?e.jsx(z,{open:m,onOpenChange:n,children:e.jsx(M,{side:"bottom",className:"h-[85vh] p-0 flex flex-col",showDragHandle:!0,children:e.jsx("div",{className:"flex-1 overflow-y-auto bg-white",children:e.jsx(g,{})})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden",children:e.jsx(g,{})})})}export{X as AddToProjectModal};
